<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>xtfa.networks - xTFA 2022-07 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">xTFA 2022-07 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">xTFA 2022-07 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../relationmanuscript.html">Relations Between the Notions of the Manuscript and their Implementation in the Tool</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../modules.html">xtfa</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../xtfa.html">xtfa package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.GurobiInterface.html">xtfa.GurobiInterface module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.MilpInterface.html">xtfa.MilpInterface module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.baharevMfas.html">xtfa.baharevMfas module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.clocks.html">xtfa.clocks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.contentionPipelines.html">xtfa.contentionPipelines module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.fasUtility.html">xtfa.fasUtility module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.flows.html">xtfa.flows module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.graphUtility.html">xtfa.graphUtility module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.inputPipelines.html">xtfa.inputPipelines module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.lcan.html">xtfa.lcan module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.minPlusToolbox.html">xtfa.minPlusToolbox module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.networks.html">xtfa.networks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.nodes.html">xtfa.nodes module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.outputPipelines.html">xtfa.outputPipelines module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.plotUtility.html">xtfa.plotUtility module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.unitUtility.html">xtfa.unitUtility module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for xtfa.networks</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="c1">#</span>
<span class="c1"># This file is part of xTFA</span>
<span class="c1"># Copyright (c) 2021-2022 Ludovic Thomas (ISAE-SUPAERO)</span>
<span class="c1"># </span>
<span class="c1"># This program is free software: you can redistribute it and/or modify  </span>
<span class="c1"># it under the terms of the GNU General Public License as published by  </span>
<span class="c1"># the Free Software Foundation, version 3.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful, but </span>
<span class="c1"># WITHOUT ANY WARRANTY; without even the implied warranty of </span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU </span>
<span class="c1"># General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License </span>
<span class="c1"># along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">"""</span>
<span class="sd">This module contains all the class useful for defining a network, managing the TFA iteration one node after another etc.</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Mapping</span>
<span class="kn">import</span> <span class="nn">networkx</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">xtfa.fasUtility</span>

<span class="kn">from</span> <span class="nn">xtfa.clocks</span> <span class="kn">import</span> <span class="n">Clock</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">contentionPipelines</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">inputPipelines</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">minPlusToolbox</span> <span class="k">as</span> <span class="n">mpt</span>
<span class="kn">from</span> <span class="nn">xtfa.flows</span> <span class="kn">import</span> <span class="n">AtsCurveNotKnown</span><span class="p">,</span> <span class="n">CurveNotKnown</span><span class="p">,</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">FlowState</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">nodes</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">unitUtility</span>



<span class="n">loggercc</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">"CYC"</span><span class="p">)</span>
<span class="n">loggerff</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">"FFC"</span><span class="p">)</span>

<div class="viewcode-block" id="ProcessANode"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.ProcessANode">[docs]</a><span class="k">class</span> <span class="nc">ProcessANode</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    This class is used to compute all the pipelines of a node.</span>
<span class="sd">    As a sub-class of Thread, we can spawn it, resulting in several nodes computed at the same time</span>

<span class="sd">    Inheritance:</span>
<span class="sd">        threading.Thread:</span>

<span class="sd">    """</span>
    <span class="n">_net</span><span class="p">:</span> <span class="s1">'FeedForwardNetwork'</span>  <span class="c1">#The network associated</span>
    <span class="n">_nodeName</span><span class="p">:</span> <span class="nb">str</span>              <span class="c1">#The name of the node associated</span>
    <span class="n">_node</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Node</span>           <span class="c1">#The model of the associated node</span>
    <span class="n">postpone</span><span class="p">:</span> <span class="nb">bool</span>              <span class="c1">#True if we need to postpone the computation of this node because not all inputs are known</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_net</span> <span class="o">=</span> <span class="n">net</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span> <span class="o">=</span> <span class="n">nodeName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">postpone</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Processing_</span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">nodeName</span><span class="p">)</span>

<div class="viewcode-block" id="ProcessANode.prepareNode"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.ProcessANode.prepareNode">[docs]</a>    <span class="k">def</span> <span class="nf">prepareNode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""This method reports the flow states from the the network's gif (graph induced by flows) to the input of the node model</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"flow_states"</span><span class="p">,</span><span class="nb">list</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">addIncomingFlowState</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProcessANode.computeNode"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.ProcessANode.computeNode">[docs]</a>    <span class="k">def</span> <span class="nf">computeNode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">processNode</span><span class="p">()</span></div>

<div class="viewcode-block" id="ProcessANode.propagate"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.ProcessANode.propagate">[docs]</a>    <span class="k">def</span> <span class="nf">propagate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#clear all the edge lists in outgoing edge (to clear cuts assumptions in case of cyclic computations)</span>
        <span class="k">for</span> <span class="n">out</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">):</span>
            <span class="k">if</span><span class="p">(</span><span class="s2">"flow_states"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">out</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">out</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1">#Retrive the list of flow states at the output of the previous node and write tham </span>
        <span class="n">outgoingFlowStates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">getOutputFlowStates</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">outFS</span> <span class="ow">in</span> <span class="n">outgoingFlowStates</span><span class="p">:</span>
            <span class="n">theFlow</span> <span class="o">=</span> <span class="n">outFS</span><span class="o">.</span><span class="n">flow</span>
            <span class="k">for</span> <span class="n">outgoingEdge</span> <span class="ow">in</span> <span class="n">theFlow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">):</span>
                <span class="n">newFS</span> <span class="o">=</span> <span class="n">outFS</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">newFS</span><span class="o">.</span><span class="n">atEdge</span> <span class="o">=</span> <span class="n">outgoingEdge</span>
                <span class="c1">#Change the clock if needed</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">"flow_states"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outgoingEdge</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outgoingEdge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outgoingEdge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newFS</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">"flow_states"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">theFlow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outgoingEdge</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">theFlow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outgoingEdge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="n">theFlow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outgoingEdge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newFS</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="s2">"flow_states"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">theFlow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">theFlow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="n">theFlow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outFS</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">outEdge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outEdge</span><span class="p">][</span><span class="s2">"edge_ready"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="ProcessANode.run"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.ProcessANode.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepareNode</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">computeNode</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">CurveNotKnown</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postpone</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">clearComputations</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">AtsCurveNotKnown</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postpone</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_node</span><span class="o">.</span><span class="n">clearComputations</span><span class="p">()</span></div></div>

<div class="viewcode-block" id="WopanetReader"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.WopanetReader">[docs]</a><span class="k">class</span> <span class="nc">WopanetReader</span><span class="p">:</span>
    <span class="sd">"""This is an utility class that reads the file format of wopanet</span>
<span class="sd">    """</span>

    <span class="n">keysInWopanetXML</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"network"</span><span class="p">:</span> <span class="s2">"network"</span><span class="p">,</span>
        <span class="s2">"network_name"</span><span class="p">:</span> <span class="s2">"name"</span><span class="p">,</span>
        <span class="s2">"end_system"</span><span class="p">:</span> <span class="s2">"station"</span><span class="p">,</span>
        <span class="s2">"switch"</span><span class="p">:</span> <span class="s2">"switch"</span><span class="p">,</span>
        <span class="s2">"phy_node_name"</span><span class="p">:</span> <span class="s2">"name"</span><span class="p">,</span>
        <span class="s2">"link"</span><span class="p">:</span> <span class="s2">"link"</span><span class="p">,</span>
        <span class="s2">"link_from"</span><span class="p">:</span> <span class="s2">"from"</span><span class="p">,</span>
        <span class="s2">"link_to"</span><span class="p">:</span> <span class="s2">"to"</span><span class="p">,</span>
        <span class="s2">"link_name"</span><span class="p">:</span> <span class="s2">"name"</span><span class="p">,</span>
        <span class="s2">"flow"</span><span class="p">:</span> <span class="s2">"flow"</span><span class="p">,</span>
        <span class="s2">"flow_path"</span><span class="p">:</span> <span class="s2">"target"</span><span class="p">,</span>
        <span class="s2">"flow_path_step"</span><span class="p">:</span> <span class="s2">"path"</span><span class="p">,</span>
        <span class="s2">"flow_path_step_name"</span><span class="p">:</span> <span class="s2">"node"</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overridingNetDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overridingNodeDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overridingLinkDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="WopanetReader.populateNetworkName"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.WopanetReader.populateNetworkName">[docs]</a>    <span class="k">def</span> <span class="nf">populateNetworkName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'FeedForwardNetwork'</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="n">netElements</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"network"</span><span class="p">])</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">netElements</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span><span class="s2">"Too many network items in XML"</span><span class="p">)</span>
        <span class="n">theDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">netElements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">overridingNetDict</span><span class="p">)</span>
        <span class="n">net</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">theDict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"network_name"</span><span class="p">],</span><span class="s2">"Network"</span><span class="p">)</span>
        <span class="n">net</span><span class="o">.</span><span class="n">netFlags</span> <span class="o">=</span> <span class="n">theDict</span></div>

<div class="viewcode-block" id="WopanetReader.getOutportNameAndPropertiesFromPhy"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.WopanetReader.getOutportNameAndPropertiesFromPhy">[docs]</a>    <span class="k">def</span> <span class="nf">getOutportNameAndPropertiesFromPhy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phyGraph</span><span class="p">:</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="n">phyNodeFrom</span><span class="p">,</span> <span class="n">phyNodeTo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
        <span class="n">phyLink</span> <span class="o">=</span> <span class="n">phyGraph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">phyNodeFrom</span><span class="p">,</span> <span class="n">phyNodeTo</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">phyLink</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">ParseError</span><span class="p">(</span><span class="s2">"no physical link for </span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span><span class="p">(</span><span class="n">phyNodeFrom</span><span class="p">,</span> <span class="n">phyNodeTo</span><span class="p">))</span>
        <span class="n">mFrom</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">phyNodeFrom</span> <span class="o">==</span> <span class="n">phyLink</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"from"</span><span class="p">):</span>
            <span class="n">mFrom</span> <span class="o">=</span> <span class="s2">"from"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mFrom</span> <span class="o">=</span> <span class="s2">"to"</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">"phylink_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">phyLink</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">"phynode_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">phyNodeFrom</span>
        <span class="k">return</span> <span class="n">phyNodeFrom</span> <span class="o">+</span> <span class="s2">"-"</span> <span class="o">+</span> <span class="n">phyLink</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mFrom</span> <span class="o">+</span> <span class="s2">"Port"</span><span class="p">),</span> <span class="n">attributes</span></div>


<div class="viewcode-block" id="WopanetReader.populatePhyTopo"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.WopanetReader.populatePhyTopo">[docs]</a>    <span class="k">def</span> <span class="nf">populatePhyTopo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'FeedForwardNetwork'</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="n">net</span><span class="o">.</span><span class="n">physicalTopo</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="c1">#nodes</span>
        <span class="k">for</span> <span class="n">phyNodeElement</span> <span class="ow">in</span> <span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"end_system"</span><span class="p">])):</span>
            <span class="n">phyNodeUName</span> <span class="o">=</span> <span class="n">phyNodeElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"phy_node_name"</span><span class="p">])</span>
            <span class="n">net</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">phyNodeUName</span><span class="p">,</span> <span class="o">**</span><span class="n">phyNodeElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"end_system"</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">overridingNodeDict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">phyNodeElement</span> <span class="ow">in</span> <span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"switch"</span><span class="p">])):</span>
            <span class="n">phyNodeUName</span> <span class="o">=</span> <span class="n">phyNodeElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"phy_node_name"</span><span class="p">])</span>
            <span class="n">net</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">phyNodeUName</span><span class="p">,</span> <span class="o">**</span><span class="n">phyNodeElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"switch"</span><span class="p">],</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">overridingNodeDict</span><span class="p">)</span>
        <span class="c1">#links</span>
        <span class="k">for</span> <span class="n">linkElement</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"link"</span><span class="p">]):</span>
            <span class="n">net</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">linkElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"link_from"</span><span class="p">]),</span><span class="n">linkElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"link_to"</span><span class="p">]),</span> <span class="o">**</span><span class="n">linkElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">overridingLinkDict</span><span class="p">)</span></div>

<div class="viewcode-block" id="WopanetReader.populateFlows"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.WopanetReader.populateFlows">[docs]</a>    <span class="k">def</span> <span class="nf">populateFlows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'FeedForwardNetwork'</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="n">net</span><span class="o">.</span><span class="n">flows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">flowElement</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"flow"</span><span class="p">]):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="o">.</span><span class="n">getFlowFromWopanetParams</span><span class="p">(</span><span class="o">**</span><span class="n">flowElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
            <span class="n">net</span><span class="o">.</span><span class="n">flows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">flowPathElement</span> <span class="ow">in</span> <span class="n">flowElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"flow_path"</span><span class="p">]):</span>
                <span class="n">phyNode</span> <span class="o">=</span> <span class="n">flowElement</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s2">"source"</span><span class="p">]</span>
                <span class="n">prevOutPortNode</span> <span class="o">=</span> <span class="s2">""</span>
                <span class="k">for</span> <span class="n">flowPathStepElement</span> <span class="ow">in</span> <span class="n">flowPathElement</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"flow_path_step"</span><span class="p">]):</span>
                    <span class="n">nextPhyNode</span> <span class="o">=</span> <span class="n">flowPathStepElement</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"flow_path_step_name"</span><span class="p">])</span>
                    <span class="n">outPortNodeName</span><span class="p">,</span> <span class="n">outPortAttributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOutportNameAndPropertiesFromPhy</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">physicalTopo</span><span class="p">,</span><span class="n">phyNode</span><span class="p">,</span><span class="n">nextPhyNode</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">outPortNodeName</span><span class="p">,</span> <span class="o">**</span><span class="n">outPortAttributes</span><span class="p">)</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">prevOutPortNode</span><span class="p">):</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">prevOutPortNode</span><span class="p">,</span> <span class="n">outPortNodeName</span><span class="p">)</span>
                    <span class="n">phyNode</span> <span class="o">=</span> <span class="n">nextPhyNode</span>
                    <span class="n">prevOutPortNode</span> <span class="o">=</span> <span class="n">outPortNodeName</span>
            <span class="c1">#register all sources</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">n</span><span class="p">)):</span>
                    <span class="c1">#not has no predecessor, this is a source (in most cases, it is unique)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">sources</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="WopanetReader.populateOdg"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.WopanetReader.populateOdg">[docs]</a>    <span class="k">def</span> <span class="nf">populateOdg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'FeedForwardNetwork'</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="n">net</span><span class="o">.</span><span class="n">gif</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="n">net</span><span class="o">.</span><span class="n">gif</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">gif</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="WopanetReader.getPhyEdgeFromName"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.WopanetReader.getPhyEdgeFromName">[docs]</a>    <span class="k">def</span> <span class="nf">getPhyEdgeFromName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'FeedForwardNetwork'</span><span class="p">,</span> <span class="n">edgeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">net</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">keysInWopanetXML</span><span class="p">[</span><span class="s2">"link_name"</span><span class="p">]]</span> <span class="o">==</span> <span class="n">edgeName</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">edge</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="WopanetReader.setComputationnalFlags"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.WopanetReader.setComputationnalFlags">[docs]</a>    <span class="k">def</span> <span class="nf">setComputationnalFlags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'FeedForwardNetwork'</span><span class="p">,</span> <span class="n">root</span><span class="p">:</span> <span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dic_link_level</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">getPhyEdgeFromName</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"phylink_name"</span><span class="p">])]</span>
            <span class="n">dic_node_level</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"phynode_name"</span><span class="p">]]</span>
            <span class="n">dic_network_level</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">"network"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attrib</span>

            <span class="n">newDic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">net</span><span class="o">.</span><span class="n">netFlags</span><span class="p">)</span>
            <span class="n">newDic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">newDic</span><span class="p">,</span> <span class="o">**</span><span class="n">dic_network_level</span><span class="p">)</span>
            <span class="n">newDic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">newDic</span><span class="p">,</span> <span class="o">**</span><span class="n">dic_node_level</span><span class="p">)</span>
            <span class="n">newDic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">newDic</span><span class="p">,</span> <span class="o">**</span><span class="n">dic_link_level</span><span class="p">)</span>
            <span class="n">net</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"computational_flags"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="n">newDic</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="n">newDic</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span></div>
            
<div class="viewcode-block" id="WopanetReader.configure_network_from_xml"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.WopanetReader.configure_network_from_xml">[docs]</a>    <span class="k">def</span> <span class="nf">configure_network_from_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'FeedForwardNetwork'</span><span class="p">,</span> <span class="n">xmlFileName</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">xmlFileName</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>

        <span class="c1">#Retrieve network name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populateNetworkName</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

        <span class="c1">#Populating physical topology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populatePhyTopo</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

        <span class="c1">#Populating all flows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populateFlows</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

        <span class="c1">#Compute ODG</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populateOdg</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

        <span class="c1">#Set the node models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setComputationnalFlags</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">net</span></div></div>

<div class="viewcode-block" id="NetworkInterface"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface">[docs]</a><span class="k">class</span> <span class="nc">NetworkInterface</span><span class="p">:</span>
    <span class="sd">"""Minimum interface to be implemented by a network</span>
<span class="sd">    """</span>
<div class="viewcode-block" id="NetworkInterface.setPlotDelayComputations"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.setPlotDelayComputations">[docs]</a>    <span class="k">def</span> <span class="nf">setPlotDelayComputations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
    
<div class="viewcode-block" id="NetworkInterface.auto_install_pipelines"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.auto_install_pipelines">[docs]</a>    <span class="k">def</span> <span class="nf">auto_install_pipelines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="NetworkInterface.setMultiThread"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.setMultiThread">[docs]</a>    <span class="k">def</span> <span class="nf">setMultiThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="NetworkInterface.setArrivalCurveForAllFlowsAtSource"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.setArrivalCurveForAllFlowsAtSource">[docs]</a>    <span class="k">def</span> <span class="nf">setArrivalCurveForAllFlowsAtSource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="NetworkInterface.setServiceCurveForAllFifoContentionSteps"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.setServiceCurveForAllFifoContentionSteps">[docs]</a>    <span class="k">def</span> <span class="nf">setServiceCurveForAllFifoContentionSteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serviceCurve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Sets the service curve of all the FIFO queing elements in the network (the FIFO contention step in the contention pipeline). This must be called AFTER the micromodels have been installed on the nodes</span>

<span class="sd">        Args:</span>
<span class="sd">            serviceCurve (mpt.Curve): the service curve to set</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: in case the subclass does not override</span>
<span class="sd">        """</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="NetworkInterface.setPacketSizeForAllFlows"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.setPacketSizeForAllFlows">[docs]</a>    <span class="k">def</span> <span class="nf">setPacketSizeForAllFlows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxPacketSize</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">minPacketSize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>


<div class="viewcode-block" id="NetworkInterface.setShapingCapacityForAllInputShapingSteps"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.setShapingCapacityForAllInputShapingSteps">[docs]</a>    <span class="k">def</span> <span class="nf">setShapingCapacityForAllInputShapingSteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapingCapacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="NetworkInterface.setTransmissionSpeedForAllMohammadpourImprovementSteps"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.setTransmissionSpeedForAllMohammadpourImprovementSteps">[docs]</a>    <span class="k">def</span> <span class="nf">setTransmissionSpeedForAllMohammadpourImprovementSteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transmissionSpeed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="NetworkInterface.setReferenceLinkSpeedForAllPacketizers"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.setReferenceLinkSpeedForAllPacketizers">[docs]</a>    <span class="k">def</span> <span class="nf">setReferenceLinkSpeedForAllPacketizers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linkSpeed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="NetworkInterface.printMinMaxDelayUpperBound"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.printMinMaxDelayUpperBound">[docs]</a>    <span class="k">def</span> <span class="nf">printMinMaxDelayUpperBound</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="NetworkInterface.getOrderedDelayUpperBoundList"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.getOrderedDelayUpperBoundList">[docs]</a>    <span class="k">def</span> <span class="nf">getOrderedDelayUpperBoundList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">""" Returns the list of the delay upper bound, ordered in increasing values</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[float]: the list of increasing delay upperbounds</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span></div>
    
<div class="viewcode-block" id="NetworkInterface.getOrderedDelayUpperBoundListWithDeadlines"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.getOrderedDelayUpperBoundListWithDeadlines">[docs]</a>    <span class="k">def</span> <span class="nf">getOrderedDelayUpperBoundListWithDeadlines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="sd">""" Returns the ordered list of delay bounds, together with the deadlines</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[float],List[float]]: first element of the tuple, a list of the delay upperbounds, in increasing order. second element: a list of the corresponding deadlines, for the flows in the same order as in the previous list: not necessarely in increasing order, for example if a flow has a small delay bound and a high deadline.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span></div>

<div class="viewcode-block" id="NetworkInterface.getDelayBoundFlowDestination"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.getDelayBoundFlowDestination">[docs]</a>    <span class="k">def</span> <span class="nf">getDelayBoundFlowDestination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span></div>

<div class="viewcode-block" id="NetworkInterface.getNodeUsage"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.getNodeUsage">[docs]</a>    <span class="k">def</span> <span class="nf">getNodeUsage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span></div>

<div class="viewcode-block" id="NetworkInterface.compute"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="NetworkInterface.getWorstFlowDeadlineMargin"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.NetworkInterface.getWorstFlowDeadlineMargin">[docs]</a>    <span class="k">def</span> <span class="nf">getWorstFlowDeadlineMargin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span></div></div>
    
<div class="viewcode-block" id="FeedForwardNetwork"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork">[docs]</a><span class="k">class</span> <span class="nc">FeedForwardNetwork</span><span class="p">(</span><span class="n">NetworkInterface</span><span class="p">):</span>
    <span class="sd">"""This class represent a feed-forward FIFO network with the TFA method</span>
<span class="sd">    """</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>                       <span class="c1">#Name of the network</span>
    <span class="n">flows</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Flow</span><span class="p">]</span>               <span class="c1">#List of the flows in the network (only one class)</span>
    <span class="n">physicalTopo</span><span class="p">:</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span>    <span class="c1">#Graph representing the physical topology</span>
    <span class="n">gif</span><span class="p">:</span> <span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span>           <span class="c1">#Graph induced by the flows, see Chapter 2 of the manuscript</span>
    <span class="n">doMultithread</span><span class="p">:</span> <span class="nb">bool</span>             <span class="c1">#True if we want the mutlithread feature (all ready nodes ar computed in //)</span>
    <span class="n">netFlags</span><span class="p">:</span> <span class="nb">dict</span>                  <span class="c1">#The network-level computational flags</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doMultithread</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">netFlags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gif</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<div class="viewcode-block" id="FeedForwardNetwork.setArrivalCurveForAllFlowsAtSource"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.setArrivalCurveForAllFlowsAtSource">[docs]</a>    <span class="k">def</span> <span class="nf">setArrivalCurveForAllFlowsAtSource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""utility method that overwrites all the source arrival curve</span>

<span class="sd">        Args:</span>
<span class="sd">            curve (mpt.Curve): arrival curve to set to all flows</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="n">flow</span><span class="o">.</span><span class="n">sourceArrivalCurve</span> <span class="o">=</span> <span class="n">curve</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.getFlowFromName"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getFlowFromName">[docs]</a>    <span class="k">def</span> <span class="nf">getFlowFromName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Flow</span><span class="p">]:</span>
        <span class="sd">"""Obtain a Flow object from the flow name</span>

<span class="sd">        Args:</span>
<span class="sd">            flowName (str): name to look for</span>

<span class="sd">        Returns:</span>
<span class="sd">            Flow: the Flow whose name is the provided name</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">flowName</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">f</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.countFlowName"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.countFlowName">[docs]</a>    <span class="k">def</span> <span class="nf">countFlowName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">"""Count the number of flows that have the same name - Should never be more than 1</span>

<span class="sd">        Args:</span>
<span class="sd">            flowName (str): the name to look for</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: the number of matching flows (should equal 1 at all times)</span>
<span class="sd">        """</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">flowName</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.setServiceCurveForAllFifoContentionSteps"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.setServiceCurveForAllFifoContentionSteps">[docs]</a>    <span class="k">def</span> <span class="nf">setServiceCurveForAllFifoContentionSteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">serviceCurve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Method to overwritte the service curve of all nodes</span>

<span class="sd">        Args:</span>
<span class="sd">            serviceCurve (mpt.Curve): the service curve to set</span>
<span class="sd">        """</span> 
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">contentionStep</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">contentionPipeline</span><span class="o">.</span><span class="n">_pipelineSteps</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">contentionStep</span><span class="p">,</span> <span class="n">contentionPipelines</span><span class="o">.</span><span class="n">FifoContentionStep</span><span class="p">)):</span>
                    <span class="n">contentionStep</span><span class="o">.</span><span class="n">setServiceCurve</span><span class="p">(</span><span class="n">serviceCurve</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.setPacketSizeForAllFlows"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.setPacketSizeForAllFlows">[docs]</a>    <span class="k">def</span> <span class="nf">setPacketSizeForAllFlows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxPacketSize</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">minPacketSize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Method to overwritte the packet sizes of all flows</span>

<span class="sd">        Args:</span>
<span class="sd">            maxPacketSize (int): max packet size to set</span>
<span class="sd">            minPacketSize (Optional[int], optional): min packet size to set. Defaults to 0.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="n">flow</span><span class="o">.</span><span class="n">maxPacketLength</span> <span class="o">=</span> <span class="n">maxPacketSize</span>
            <span class="n">flow</span><span class="o">.</span><span class="n">minPacketLength</span> <span class="o">=</span> <span class="n">minPacketSize</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.setShapingCapacityForAllInputShapingSteps"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.setShapingCapacityForAllInputShapingSteps">[docs]</a>    <span class="k">def</span> <span class="nf">setShapingCapacityForAllInputShapingSteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shapingCapacity</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Method to overwritte the shaping capacity (ie transmission rate) of all nodes</span>

<span class="sd">        Args:</span>
<span class="sd">            shapingCapacity (float): the shaping capacity to set</span>
<span class="sd">        """</span>
        <span class="n">commonCurve</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">LeakyBucket</span><span class="p">(</span><span class="n">shapingCapacity</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">inputStep</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">inputPipeline</span><span class="o">.</span><span class="n">pipeline</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">inputStep</span><span class="p">,</span> <span class="n">inputPipelines</span><span class="o">.</span><span class="n">InputPortShapingInputPipelineStep</span><span class="p">)):</span>
                    <span class="n">inputStep</span><span class="o">.</span><span class="n">overrideAllShapingCurvesForAlreadyConfiguredEdges</span><span class="p">(</span><span class="n">commonCurve</span><span class="p">)</span></div>
                    
    
<div class="viewcode-block" id="FeedForwardNetwork.setTransmissionSpeedForAllMohammadpourImprovementSteps"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.setTransmissionSpeedForAllMohammadpourImprovementSteps">[docs]</a>    <span class="k">def</span> <span class="nf">setTransmissionSpeedForAllMohammadpourImprovementSteps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transmissionSpeed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Method to overwritte the tranmission rate for the Mohammadpour improvement in all nodes</span>

<span class="sd">        Args:</span>
<span class="sd">            transmissionSpeed (float): transmission rate to set</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">contentionStep</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">contentionPipeline</span><span class="o">.</span><span class="n">_pipelineSteps</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">contentionStep</span><span class="p">,</span> <span class="n">contentionPipelines</span><span class="o">.</span><span class="n">MohammadpourEtAlImprovementStep</span><span class="p">)):</span>
                    <span class="n">contentionStep</span><span class="o">.</span><span class="n">setOutputLinkSpeed</span><span class="p">(</span><span class="n">transmissionSpeed</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.setReferenceLinkSpeedForAllPacketizers"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.setReferenceLinkSpeedForAllPacketizers">[docs]</a>    <span class="k">def</span> <span class="nf">setReferenceLinkSpeedForAllPacketizers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linkSpeed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Set the transmission rate for all packetizers in all nodes</span>

<span class="sd">        Args:</span>
<span class="sd">            linkSpeed (float): tranmission rate used by the packetizer model</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">inputStep</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">inputPipeline</span><span class="o">.</span><span class="n">pipeline</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">inputStep</span><span class="p">,</span> <span class="n">inputPipelines</span><span class="o">.</span><span class="n">PacketizationInputPipelineStep</span><span class="p">)):</span>
                    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">inputStep</span><span class="o">.</span><span class="n">getEdgeListInLinkSpeedDictionnary</span><span class="p">():</span>
                        <span class="n">inputStep</span><span class="o">.</span><span class="n">setLinkSpeedForIncommingEdge</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="n">linkSpeed</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.printFlowResults"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.printFlowResults">[docs]</a>    <span class="k">def</span> <span class="nf">printFlowResults</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Prints the results for all flows</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"&gt;&gt; Flow </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" ["</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">''</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">toStringWithoutAt</span><span class="p">()</span> <span class="o">+</span> <span class="s2">","</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\b</span><span class="s2">]"</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.setPlotDelayComputations"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.setPlotDelayComputations">[docs]</a>    <span class="k">def</span> <span class="nf">setPlotDelayComputations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Plots the delay in all the nodes provided in the node list</span>

<span class="sd">        Args:</span>
<span class="sd">            nodeList (List[str]): list of nodes on which to plot the computation of the delay</span>
<span class="sd">        """</span>
        <span class="k">if</span><span class="p">(</span><span class="n">nodeList</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doMultithread</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="ow">in</span> <span class="n">nodeList</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">"all"</span> <span class="ow">in</span> <span class="n">nodeList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"computational_flags"</span><span class="p">][</span><span class="s2">"plot-delay-computation"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"True"</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"computational_flags"</span><span class="p">][</span><span class="s2">"plot-delay-computation-flags"</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"computational_flags"</span><span class="p">][</span><span class="s2">"plot-delay-computation"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"False"</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.setPlotPartitionResults"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.setPlotPartitionResults">[docs]</a>    <span class="k">def</span> <span class="nf">setPlotPartitionResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Enable the plot of the partitions (for debuging) on selected nodes</span>

<span class="sd">        Args:</span>
<span class="sd">            nodeList (List[str]): list of node on which to plot the partitions</span>
<span class="sd">        """</span>
        <span class="k">if</span><span class="p">(</span><span class="n">nodeList</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doMultithread</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="ow">in</span> <span class="n">nodeList</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">"all"</span> <span class="ow">in</span> <span class="n">nodeList</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"computational_flags"</span><span class="p">][</span><span class="s2">"plot-partition-result"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"True"</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"computational_flags"</span><span class="p">][</span><span class="s2">"plot-partition-result-flags"</span><span class="p">]</span> <span class="o">=</span> <span class="n">kargs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"computational_flags"</span><span class="p">][</span><span class="s2">"plot-partition-result"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"False"</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.auto_install_pipelines"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.auto_install_pipelines">[docs]</a>    <span class="k">def</span> <span class="nf">auto_install_pipelines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Automatically install the computational models (ie computational pipelines) based on the computational flags</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">nodeName</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">nodeName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nodeName</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
            <span class="n">n</span><span class="o">.</span><span class="n">autoInstallPipelines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nodeName</span><span class="p">][</span><span class="s2">"computational_flags"</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.isNodeReadyForComputation"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.isNodeReadyForComputation">[docs]</a>    <span class="k">def</span> <span class="nf">isNodeReadyForComputation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">nodeName</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">in_edges</span><span class="p">(</span><span class="n">nodeName</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"edge_ready"</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.readyNodesCount"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.readyNodesCount">[docs]</a>    <span class="k">def</span> <span class="nf">readyNodesCount</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span><span class="o">.</span><span class="n">isFinished</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isNodeReadyForComputation</span><span class="p">(</span><span class="n">node</span><span class="p">)):</span>
                <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">c</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.remainingNodesCount"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.remainingNodesCount">[docs]</a>    <span class="k">def</span> <span class="nf">remainingNodesCount</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span><span class="o">.</span><span class="n">isFinished</span><span class="p">()):</span>
                <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">c</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.getReadyNodes"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getReadyNodes">[docs]</a>    <span class="k">def</span> <span class="nf">getReadyNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span><span class="o">.</span><span class="n">isFinished</span><span class="p">()))</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">isNodeReadyForComputation</span><span class="p">(</span><span class="n">node</span><span class="p">))):</span>
                <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.feedForwardComputation"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.feedForwardComputation">[docs]</a>    <span class="k">def</span> <span class="nf">feedForwardComputation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Perform the TFA computation</span>
<span class="sd">        """</span>
        <span class="k">while</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remainingNodesCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="c1">#print("[FFC] Iteration: %d. Remaining nodes: %d. Ready nodes: %d" % (feedForwardIteration, self.remainingNodesCount(), self.readyNodesCount()))</span>
            <span class="n">readyNodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getReadyNodes</span><span class="p">()</span> 
            <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">readyNodes</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">"No node ready"</span><span class="p">)</span>
            <span class="n">loggerff</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">:Remaining nodes:</span><span class="si">%d</span><span class="s2"> | Nodes ready:</span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remainingNodesCount</span><span class="p">(),</span><span class="nb">len</span><span class="p">(</span><span class="n">readyNodes</span><span class="p">)))</span>
            <span class="n">runningThreads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">readyNodes</span><span class="p">:</span>
                <span class="n">newTh</span> <span class="o">=</span> <span class="n">ProcessANode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doMultithread</span><span class="p">):</span>
                    <span class="n">newTh</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">newTh</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
                <span class="n">runningThreads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newTh</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">runningThreads</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doMultithread</span><span class="p">):</span>
                    <span class="n">th</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
                <span class="n">allRequirePostpone</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">th</span><span class="o">.</span><span class="n">postpone</span><span class="p">):</span>
                    <span class="n">allRequirePostpone</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="n">th</span><span class="o">.</span><span class="n">propagate</span><span class="p">()</span>
                <span class="k">if</span><span class="p">(</span><span class="n">allRequirePostpone</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">"All nodes require postponing their computation due to FRER/ATS curve not being known upstream. This can occur in a network with cyclic-dependencies and can be due to not having enough cuts in the topology. The following nodes are requesting postponement of their computation: </span><span class="si">%r</span><span class="s2">"</span> <span class="o">%</span> <span class="nb">list</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">_nodeName</span> <span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="n">runningThreads</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.compute"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">feedForwardComputation</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.setMultiThread"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.setMultiThread">[docs]</a>    <span class="k">def</span> <span class="nf">setMultiThread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doMultithread</span> <span class="o">=</span> <span class="n">enabled</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.stringMinMaxDelayUpperBound"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.stringMinMaxDelayUpperBound">[docs]</a>    <span class="k">def</span> <span class="nf">stringMinMaxDelayUpperBound</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Returns min/max delay upper bounds across all flows</span>
<span class="sd">        """</span>
        <span class="n">delayList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOrderedDelayUpperBoundList</span><span class="p">()</span>
        <span class="k">return</span><span class="p">(</span><span class="s2">"MinUpperBound=</span><span class="si">%.2e</span><span class="s2"> MaxUpperBound=</span><span class="si">%.2e</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">delayList</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">delayList</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.getOrderedDelayUpperBoundListOnePerFlow"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getOrderedDelayUpperBoundListOnePerFlow">[docs]</a>    <span class="k">def</span> <span class="nf">getOrderedDelayUpperBoundListOnePerFlow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">delayList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="n">delayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">node</span><span class="p">))))</span>
        <span class="n">delayList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">delayList</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.getOrderedDelayUpperBoundListWithDeadlinesOnePerFlow"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getOrderedDelayUpperBoundListWithDeadlinesOnePerFlow">[docs]</a>    <span class="k">def</span> <span class="nf">getOrderedDelayUpperBoundListWithDeadlinesOnePerFlow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="n">delayList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">deadlineList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="n">delayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">node</span><span class="p">))))</span>
            <span class="n">deadlineList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unitUtility</span><span class="o">.</span><span class="n">readTime</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"deadline"</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">deadlineList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">delayList</span><span class="p">,</span><span class="n">deadlineList</span><span class="p">))]</span> 
        <span class="n">delayList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">delayList</span><span class="p">,</span> <span class="n">deadlineList</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.getOrderedDelayUpperBoundList"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getOrderedDelayUpperBoundList">[docs]</a>    <span class="k">def</span> <span class="nf">getOrderedDelayUpperBoundList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">delayList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                    <span class="n">delayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">])</span>
        <span class="n">delayList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">delayList</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.getOrderedDelayUpperBoundListWithDeadlines"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getOrderedDelayUpperBoundListWithDeadlines">[docs]</a>    <span class="k">def</span> <span class="nf">getOrderedDelayUpperBoundListWithDeadlines</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
        <span class="n">delayList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">deadlineList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                    <span class="n">delayList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">])</span>
                    <span class="n">deadlineList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unitUtility</span><span class="o">.</span><span class="n">readTime</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"deadline"</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
        <span class="n">deadlineList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">delayList</span><span class="p">,</span><span class="n">deadlineList</span><span class="p">))]</span> 
        <span class="n">delayList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">delayList</span><span class="p">,</span> <span class="n">deadlineList</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.getRemotePhyNode"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getRemotePhyNode">[docs]</a>    <span class="k">def</span> <span class="nf">getRemotePhyNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputPort</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">localNode</span><span class="p">,</span> <span class="n">localPort</span> <span class="o">=</span> <span class="n">outputPort</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"-"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">localNode</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"from"</span><span class="p">]</span> <span class="o">==</span> <span class="n">localNode</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"fromPort"</span><span class="p">]</span> <span class="o">==</span> <span class="n">localPort</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"to"</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"to"</span><span class="p">]</span> <span class="o">==</span> <span class="n">localNode</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"toPort"</span><span class="p">]</span> <span class="o">==</span> <span class="n">localPort</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"from"</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">None</span> </div>

<div class="viewcode-block" id="FeedForwardNetwork.getServiceCurveIfAllSameForPhyNode"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getServiceCurveIfAllSameForPhyNode">[docs]</a>    <span class="k">def</span> <span class="nf">getServiceCurveIfAllSameForPhyNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phyNode</span><span class="p">):</span>
        <span class="n">candidateServiceCurve</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">outLink</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">phyNode</span><span class="p">):</span>
            <span class="n">outPortIndex</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outLink</span><span class="p">][</span><span class="s2">"fromPort"</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outLink</span><span class="p">][</span><span class="s2">"from"</span><span class="p">]</span> <span class="o">==</span> <span class="n">phyNode</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">outLink</span><span class="p">][</span><span class="s2">"toPort"</span><span class="p">])</span>
            <span class="n">outPort</span> <span class="o">=</span> <span class="n">phyNode</span> <span class="o">+</span> <span class="s2">"-"</span> <span class="o">+</span> <span class="n">outPortIndex</span>
            <span class="n">outPortModel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">outPort</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span>
            <span class="n">thisServiceCurve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getServiceCurveOnNodeIfExistsInModel</span><span class="p">(</span><span class="n">outPortModel</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="n">candidateServiceCurve</span> <span class="o">==</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">candidateServiceCurve</span> <span class="o">=</span> <span class="n">thisServiceCurve</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">candidateServiceCurve</span> <span class="o">==</span> <span class="n">thisServiceCurve</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">candidateServiceCurve</span></div>
            
<div class="viewcode-block" id="FeedForwardNetwork.getServiceCurveOnNodeIfExistsInModel"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getServiceCurveOnNodeIfExistsInModel">[docs]</a>    <span class="k">def</span> <span class="nf">getServiceCurveOnNodeIfExistsInModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">contentionPipeline</span><span class="o">.</span><span class="n">_pipelineSteps</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="n">contentionPipelines</span><span class="o">.</span><span class="n">FifoContentionStep</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">el</span><span class="o">.</span><span class="n">getServiceCurveCopy</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.drawPhyNetFromInternalCoordinates"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.drawPhyNetFromInternalCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">drawPhyNetFromInternalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"usage"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="n">mD</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"usage"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">mD</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDrawPositionOfPort</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">"</span><span class="si">%.1f%%</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">mD</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">"r"</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">'center'</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">'center'</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"obtain_delay"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"obtain_delay"</span><span class="p">)</span>
        <span class="n">mPos</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"x"</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"y"</span><span class="p">]))</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">nodes</span><span class="p">}</span>
        <span class="n">networkx</span><span class="o">.</span><span class="n">draw_networkx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">mPos</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">)</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.drawFlowOnPhyUsingInternalCoordinates"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.drawFlowOnPhyUsingInternalCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">drawFlowOnPhyUsingInternalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowNameToDraw</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="n">head_size</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"head_size"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFlowFromName</span><span class="p">(</span><span class="n">flowNameToDraw</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">fromPhy</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"phynode_name"</span><span class="p">]</span>
            <span class="n">toPhy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRemotePhyNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">fromX</span><span class="p">,</span> <span class="n">fromY</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">fromPhy</span><span class="p">][</span><span class="n">a</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">])</span>
            <span class="n">toX</span><span class="p">,</span> <span class="n">toY</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">toPhy</span><span class="p">][</span><span class="n">b</span><span class="p">])</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'x'</span><span class="p">,</span><span class="s1">'y'</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">fromX</span><span class="p">,</span> <span class="n">fromY</span><span class="p">,</span> <span class="n">toX</span> <span class="o">-</span> <span class="n">fromX</span><span class="p">,</span> <span class="n">toY</span> <span class="o">-</span> <span class="n">fromY</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="o">*</span><span class="n">head_size</span><span class="p">),</span> <span class="n">head_length</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="o">*</span><span class="n">head_size</span><span class="p">))</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.drawOdgUsingInternalCoordinates"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.drawOdgUsingInternalCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">drawOdgUsingInternalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"weight"</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">mPos</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDrawPositionOfPort</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">}</span>
        <span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">mPos</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.drawOdgOfOneFlowUsingInternalCoordinates"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.drawOdgOfOneFlowUsingInternalCoordinates">[docs]</a>    <span class="k">def</span> <span class="nf">drawOdgOfOneFlowUsingInternalCoordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"weight"</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">mPos</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDrawPositionOfPort</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">}</span>
        <span class="n">networkx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="p">,</span> <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">mPos</span><span class="p">,</span> <span class="n">edgelist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getFlowFromName</span><span class="p">(</span><span class="n">flowName</span><span class="p">)</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span></div>


<div class="viewcode-block" id="FeedForwardNetwork.getDrawPositionOfPort"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getDrawPositionOfPort">[docs]</a>    <span class="k">def</span> <span class="nf">getDrawPositionOfPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outPort</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"weight"</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">phyNode</span> <span class="o">=</span> <span class="n">outPort</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"-"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">remotePhyNode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRemotePhyNode</span><span class="p">(</span><span class="n">outPort</span><span class="p">)</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">phyNode</span><span class="p">][</span><span class="n">a</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])</span>
        <span class="n">xRemote</span><span class="p">,</span> <span class="n">yRemote</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">physicalTopo</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">remotePhyNode</span><span class="p">][</span><span class="n">a</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">])</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">weight</span><span class="p">)</span> <span class="o">*</span> <span class="n">xRemote</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">weight</span><span class="p">)</span> <span class="o">*</span> <span class="n">yRemote</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.getDelayBoundFlowDestination"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getDelayBoundFlowDestination">[docs]</a>    <span class="k">def</span> <span class="nf">getDelayBoundFlowDestination</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFlowFromName</span><span class="p">(</span><span class="n">flowName</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getRemotePhyNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="n">nodeName</span><span class="p">:</span>
                <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.getDelayBoundFlowLeafVertex"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getDelayBoundFlowLeafVertex">[docs]</a>    <span class="k">def</span> <span class="nf">getDelayBoundFlowLeafVertex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFlowFromName</span><span class="p">(</span><span class="n">flowName</span><span class="p">)</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">nodeName</span><span class="p">:</span>
                <span class="n">candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.getEteMaxBoundFlow"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getEteMaxBoundFlow">[docs]</a>    <span class="k">def</span> <span class="nf">getEteMaxBoundFlow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getFlowFromName</span><span class="p">(</span><span class="n">flowname</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">])))</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="FeedForwardNetwork.getWorstEteDelay"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getWorstEteDelay">[docs]</a>    <span class="k">def</span> <span class="nf">getWorstEteDelay</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">tempF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEteMaxBoundFlow</span><span class="p">(</span><span class="n">tempF</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="n">thisD</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEteMaxBoundFlow</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dmax</span><span class="p">,</span> <span class="n">thisD</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dmax</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.getWorstFlowDeadlineMargin"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.getWorstFlowDeadlineMargin">[docs]</a>    <span class="k">def</span> <span class="nf">getWorstFlowDeadlineMargin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">tempF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">margin</span> <span class="o">=</span> <span class="p">(</span><span class="n">unitUtility</span><span class="o">.</span><span class="n">readTime</span><span class="p">(</span><span class="n">tempF</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">"deadline"</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEteMaxBoundFlow</span><span class="p">(</span><span class="n">tempF</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="n">thisMargin</span> <span class="o">=</span> <span class="p">(</span><span class="n">unitUtility</span><span class="o">.</span><span class="n">readTime</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="s2">"deadline"</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEteMaxBoundFlow</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="n">margin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">margin</span><span class="p">,</span> <span class="n">thisMargin</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">margin</span></div>
    
<div class="viewcode-block" id="FeedForwardNetwork.save_delay_bounds_per_destination_in_file"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.save_delay_bounds_per_destination_in_file">[docs]</a>    <span class="k">def</span> <span class="nf">save_delay_bounds_per_destination_in_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">listOfFlows</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">myList</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Flow</span><span class="p">]</span>
        <span class="k">if</span><span class="p">(</span><span class="n">listOfFlows</span><span class="p">):</span>
            <span class="n">myList</span> <span class="o">=</span> <span class="p">[</span><span class="n">flow</span> <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span> <span class="k">if</span> <span class="n">flow</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">listOfFlows</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">myList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Flow;Destination;Deadline;Bound</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="n">myList</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dest</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">getListLeafVertices</span><span class="p">():</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">;</span><span class="si">%s</span><span class="s2">;</span><span class="si">%f</span><span class="s2">;</span><span class="si">%f</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readTime</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"deadline"</span><span class="p">,</span><span class="mi">0</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDelayBoundFlowLeafVertex</span><span class="p">(</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">dest</span><span class="p">)))</span></div>

<div class="viewcode-block" id="FeedForwardNetwork.save_delay_bounds_per_node_in_file"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.FeedForwardNetwork.save_delay_bounds_per_node_in_file">[docs]</a>    <span class="k">def</span> <span class="nf">save_delay_bounds_per_node_in_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"Node;Bound</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">;</span><span class="si">%f</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span><span class="o">.</span><span class="n">contentionDelayMax</span><span class="p">))</span></div></div>
            

<div class="viewcode-block" id="CyclicNetwork"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.CyclicNetwork">[docs]</a><span class="k">class</span> <span class="nc">CyclicNetwork</span><span class="p">(</span><span class="n">FeedForwardNetwork</span><span class="p">):</span>
    <span class="sd">"""This represents a network with cyclic dependencies, it uses a fix point"""</span>

    <span class="n">cuts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">fasMethod</span><span class="p">:</span> <span class="n">xtfa</span><span class="o">.</span><span class="n">fasUtility</span><span class="o">.</span><span class="n">FeedbackArcSetMethod</span>
    <span class="n">_currentCutFlowStates</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span> <span class="n">FlowState</span><span class="p">]</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span>
    <span class="n">fixPointFailure</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">fixPointLimit</span> <span class="p">:</span> <span class="nb">int</span>
    <span class="n">matchDmax</span> <span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fasMethod</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fasMethod</span> <span class="o">=</span> <span class="n">fasMethod</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixPointFailure</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixPointLimit</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchDmax</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="CyclicNetwork.getOrderedDelayUpperBoundList"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.CyclicNetwork.getOrderedDelayUpperBoundList">[docs]</a>    <span class="k">def</span> <span class="nf">getOrderedDelayUpperBoundList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixPointFailure</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">getOrderedDelayUpperBoundList</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_getFirstFlowStatesAtCuts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span><span class="n">List</span><span class="p">[</span><span class="n">FlowState</span><span class="p">]]:</span>
        <span class="n">myDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuts</span><span class="p">:</span>
            <span class="n">listFsForEdge</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="c1">#Flow goes through the edge, create a flowstate from the initial arrival curve</span>
                    <span class="n">theFs</span> <span class="o">=</span> <span class="n">FlowState</span><span class="p">(</span><span class="n">flow</span><span class="p">)</span>
                    <span class="n">theFs</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">Clock</span> <span class="p">(</span><span class="s2">"tai"</span><span class="p">)</span>
                    <span class="n">theFs</span><span class="o">.</span><span class="n">atEdge</span> <span class="o">=</span> <span class="n">edge</span>
                    <span class="c1">#The following could also be NoCurve, it should'nt change the results. #TODO to check</span>
                    <span class="n">theFs</span><span class="o">.</span><span class="n">arrivalCurve</span> <span class="o">=</span> <span class="n">flow</span><span class="o">.</span><span class="n">sourceArrivalCurve</span>
                    <span class="c1">#For Packet Elimination computations, I need to have dictionnary that I can intersect with other flow states, so I'm going to create dictionnary with dummy values for at least the 'source' key</span>
                    <span class="n">theFs</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">theFs</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">theFs</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">listFsForEdge</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theFs</span><span class="p">)</span>
            <span class="n">myDict</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span> <span class="o">=</span> <span class="n">listFsForEdge</span>
        <span class="k">return</span> <span class="n">myDict</span>

    <span class="k">def</span> <span class="nf">_areCutSituationsIdentical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sitA</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">FlowState</span><span class="p">]],</span> <span class="n">sitB</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">FlowState</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuts</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_areTheFlowStateIdentical</span><span class="p">(</span><span class="n">sitA</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span><span class="nb">list</span><span class="p">()),</span> <span class="n">sitB</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">edge</span><span class="p">,</span> <span class="nb">list</span><span class="p">()))):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_areTheFlowStateIdentical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FlowState</span><span class="p">],</span> <span class="n">b</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FlowState</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1">#They should have the same size (same number of flow states)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1">#Then check that for each element in a, there exists an element of b that is the same flow state:</span>
        <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">ffs</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">isEqualFlowByNameAllKeysMustMatch</span><span class="p">(</span><span class="n">ffs</span><span class="p">,</span> <span class="n">match_d_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">matchDmax</span><span class="p">)):</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">found</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="c1">#Then same in the other direction</span>
        <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">ffs</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">if</span><span class="p">(</span><span class="n">ffs</span><span class="o">.</span><span class="n">isEqualFlowByNameAllKeysMustMatch</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">match_d_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">matchDmax</span><span class="p">)):</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">found</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_stringDeltaB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sitA</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">FlowState</span><span class="p">]],</span> <span class="n">sitB</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">FlowState</span><span class="p">]]):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sitA</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">sumA</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">arrivalCurve</span><span class="o">.</span><span class="n">get_burst</span><span class="p">()</span> <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">sitA</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">sumB</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">arrivalCurve</span><span class="o">.</span><span class="n">get_burst</span><span class="p">()</span> <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">sitB</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">sumB</span> <span class="o">-</span> <span class="n">sumA</span>
            <span class="k">if</span><span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">diff</span>
        <span class="k">return</span><span class="p">(</span><span class="s2">"Max burst difference: </span><span class="si">%.2e</span><span class="s2">"</span> <span class="o">%</span> <span class="n">m</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">_clearNetworkComputations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#Clean flow graph</span>
        <span class="k">for</span> <span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"flow_states"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
                <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"flow_states"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1">#Clean odg</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span><span class="o">.</span><span class="n">clearComputations</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"edge_ready"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_loadCurrentCutFlowStatesAssumptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentCutFlowStates</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">"flow_states"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"edge_ready"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">oldFs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentCutFlowStates</span><span class="p">[</span><span class="n">edge</span><span class="p">]:</span>
                <span class="n">newFs</span> <span class="o">=</span> <span class="n">oldFs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c1">#also populate flow graph</span>
                <span class="n">flow</span> <span class="o">=</span> <span class="n">newFs</span><span class="o">.</span><span class="n">flow</span>
                <span class="c1">#check we did not duplicate anything too much</span>
                <span class="k">assert</span><span class="p">(</span><span class="n">flow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flows</span><span class="p">)</span>
                <span class="c1">#append to odg</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newFs</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="s2">"flow_states"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                    <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="n">flow</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newFs</span><span class="p">)</span>
                <span class="c1"># note that we do not populate the "flow_states" key in the vertex of the flow graph</span>

    <span class="k">def</span> <span class="nf">_extractNewCutSituation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">FlowState</span><span class="p">]]:</span>
        <span class="n">newSituation</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cuts</span><span class="p">:</span>
            <span class="n">listFs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]:</span>
                <span class="n">listFs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
            <span class="n">newSituation</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span> <span class="o">=</span> <span class="n">listFs</span>
        <span class="k">return</span> <span class="n">newSituation</span>

<div class="viewcode-block" id="CyclicNetwork.setFasMethod"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.CyclicNetwork.setFasMethod">[docs]</a>    <span class="k">def</span> <span class="nf">setFasMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aFasMethod</span><span class="p">:</span> <span class="n">xtfa</span><span class="o">.</span><span class="n">fasUtility</span><span class="o">.</span><span class="n">FeedbackArcSetMethod</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fasMethod</span> <span class="o">=</span> <span class="n">aFasMethod</span></div>

<div class="viewcode-block" id="CyclicNetwork.getNodeUsage"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.CyclicNetwork.getNodeUsage">[docs]</a>    <span class="k">def</span> <span class="nf">getNodeUsage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
        <span class="n">retDic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">nodeModel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"model"</span><span class="p">]</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">nodeModel</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">)):</span>
                <span class="n">totalAc</span> <span class="o">=</span> <span class="n">nodeModel</span><span class="o">.</span><span class="n">_aggregatedArrivalCurveAtContention</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">totalAc</span><span class="p">,</span> <span class="n">mpt</span><span class="o">.</span><span class="n">NoCurve</span><span class="p">)):</span>
                <span class="n">totalRate</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">totalAc</span><span class="p">,</span> <span class="n">mpt</span><span class="o">.</span><span class="n">LeakyBucket</span><span class="p">)):</span>
                <span class="n">totalRate</span> <span class="o">=</span> <span class="n">totalAc</span><span class="o">.</span><span class="n">get_rate</span><span class="p">()</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">totalAc</span><span class="p">,</span> <span class="n">mpt</span><span class="o">.</span><span class="n">GVBR</span><span class="p">)):</span>
                <span class="n">totalRate</span> <span class="o">=</span> <span class="n">totalAc</span><span class="o">.</span><span class="n">_getLastLb</span><span class="p">()</span><span class="o">.</span><span class="n">get_rate</span><span class="p">()</span>
            <span class="n">totalCapacity</span> <span class="o">=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readRate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="s2">"computational_flags"</span><span class="p">][</span><span class="s2">"transmission-capacity"</span><span class="p">])</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="n">totalRate</span> <span class="o">/</span> <span class="n">totalCapacity</span>
            <span class="n">retDic</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">usage</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">retDic</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="CyclicNetwork.get_max_load"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.CyclicNetwork.get_max_load">[docs]</a>    <span class="k">def</span> <span class="nf">get_max_load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeUsage</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

<div class="viewcode-block" id="CyclicNetwork.cyclicComputation"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.CyclicNetwork.cyclicComputation">[docs]</a>    <span class="k">def</span> <span class="nf">cyclicComputation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="c1"># First, get the cuts from the FAS (Feedback Arc Set) method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cuts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fasMethod</span><span class="o">.</span><span class="n">get_fas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gif</span><span class="p">)</span>
        <span class="c1"># Then get an initial value for the flow states at </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previousCutFlowsStates</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentCutFlowStates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getFirstFlowStatesAtCuts</span><span class="p">()</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_areCutSituationsIdentical</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_previousCutFlowsStates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentCutFlowStates</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">loggercc</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">:Iteration </span><span class="si">%d</span><span class="s2"> starting..."</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clearNetworkComputations</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadCurrentCutFlowStatesAssumptions</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">feedForwardComputation</span><span class="p">()</span>
            <span class="n">loggercc</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stringMinMaxDelayUpperBound</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_previousCutFlowsStates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentCutFlowStates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currentCutFlowStates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extractNewCutSituation</span><span class="p">()</span>
            <span class="n">loggercc</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stringDeltaB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_previousCutFlowsStates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentCutFlowStates</span><span class="p">))</span>
            <span class="k">if</span><span class="p">(</span><span class="s2">"plotter"</span> <span class="ow">in</span> <span class="n">kargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="n">kargs</span><span class="p">[</span><span class="s2">"plotter"</span><span class="p">]</span><span class="o">.</span><span class="n">plotCdf</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">loggercc</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">:Iteration </span><span class="si">%d</span><span class="s2"> finished."</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixPointLimit</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fixPointFailure</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span></div>
    
<div class="viewcode-block" id="CyclicNetwork.compute"><a class="viewcode-back" href="../../xtfa.networks.html#xtfa.networks.CyclicNetwork.compute">[docs]</a>    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cyclicComputation</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div></div>
            
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Ludovic Thomas
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>