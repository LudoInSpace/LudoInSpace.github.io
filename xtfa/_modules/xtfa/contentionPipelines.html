<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>xtfa.contentionPipelines - xTFA 2022-07 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">xTFA 2022-07 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">xTFA 2022-07 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../relationmanuscript.html">Relations Between the Notions of the Manuscript and their Implementation in the Tool</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../modules.html">xtfa</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../xtfa.html">xtfa package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.GurobiInterface.html">xtfa.GurobiInterface module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.MilpInterface.html">xtfa.MilpInterface module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.baharevMfas.html">xtfa.baharevMfas module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.clocks.html">xtfa.clocks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.contentionPipelines.html">xtfa.contentionPipelines module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.fasUtility.html">xtfa.fasUtility module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.flows.html">xtfa.flows module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.graphUtility.html">xtfa.graphUtility module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.inputPipelines.html">xtfa.inputPipelines module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.lcan.html">xtfa.lcan module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.minPlusToolbox.html">xtfa.minPlusToolbox module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.networks.html">xtfa.networks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.nodes.html">xtfa.nodes module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.outputPipelines.html">xtfa.outputPipelines module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.plotUtility.html">xtfa.plotUtility module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.unitUtility.html">xtfa.unitUtility module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for xtfa.contentionPipelines</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="c1">#</span>
<span class="c1"># This file is part of xTFA</span>
<span class="c1"># Copyright (c) 2021-2022 Ludovic Thomas (ISAE-SUPAERO)</span>
<span class="c1"># </span>
<span class="c1"># This program is free software: you can redistribute it and/or modify  </span>
<span class="c1"># it under the terms of the GNU General Public License as published by  </span>
<span class="c1"># the Free Software Foundation, version 3.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful, but </span>
<span class="c1"># WITHOUT ANY WARRANTY; without even the implied warranty of </span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU </span>
<span class="c1"># General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License </span>
<span class="c1"># along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">"""</span>
<span class="sd">This module contains the definition of the delay-bound computation computation pipeline</span>
<span class="sd">In the software, the delay-bound computation pipeline is called the "contention pipeline" (legacy name)</span>
<span class="sd">The role of this pipeline is to compute the worst-case delay of the aggregate in this node.</span>

<span class="sd">The file is split in two parts:</span>
<span class="sd">-First all the possible computational blocks inside the pipeline are defined</span>
<span class="sd">-Then the low-state computation pipeline itself is defined.</span>
<span class="sd">"""</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">xtfa.clocks</span> <span class="kn">import</span> <span class="n">Clock</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">flows</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">minPlusToolbox</span> <span class="k">as</span> <span class="n">mpt</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">unitUtility</span>




<span class="c1">#contention pipeline</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">"CP"</span><span class="p">)</span>

<div class="viewcode-block" id="ContentionPipelineStep"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipelineStep">[docs]</a><span class="k">class</span> <span class="nc">ContentionPipelineStep</span><span class="p">:</span>
    <span class="sd">""" This interface represents a step in the contention pipeline (= the pipeline that computes the delay suffered by the flows of this class)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        _nodeName (str): the name of the node on which the pipeline step is installed</span>
<span class="sd">    """</span>

    <span class="n">_nodeName</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">theNodeName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span> <span class="o">=</span> <span class="n">theNodeName</span>
    
<div class="viewcode-block" id="ContentionPipelineStep.executeStep"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipelineStep.executeStep">[docs]</a>    <span class="k">def</span> <span class="nf">executeStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowStates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">flows</span><span class="o">.</span><span class="n">FlowState</span><span class="p">],</span> <span class="n">aggregatedArrivalCurve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">,</span> <span class="n">previousMinDelay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">previousMaxDelay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">""" Executes the step of the contention pipeline. Returns the lower- and upper-bounds for the delay that the flows suffer at this step. The subclass must override this method.</span>

<span class="sd">        Args:</span>
<span class="sd">            flowStates (List[flows.FlowState]): the list of all the flow states at the input of the contention pipeline (not at at the input of this specific pipeline step). The subclass MAY NOT modify the list or its content.</span>
<span class="sd">            aggregatedArrivalCurve (mpt.Curve): the aggregated arrival curve at the input of the contention pipeline (not at at the input of this specific pipeline step). The subclass MAY NOT modify this curbe.</span>
<span class="sd">            previousMinDelay (float): the previously accumulated minimum delay in all the previous steps in the contention pipeline</span>
<span class="sd">            previousMaxDelay (float): the previously accumulated maximum delay in all the previous steps in the contention pipeline</span>
<span class="sd">            flags (Mapping): a dictionnary of flags that can be read to receive informations from previous pipeline steps and that CAN BE MODIFIED to send informations to future pipeline steps</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float,float]: (minDelay,maxDelay) where minDelay is the minimum delay suffered at this step, maximumDelay is the maximum delay suffered at this step. Both delay MAY BE NEGATIVE if the current step represents some sort of delay improvement due to NC's results.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">NotImplemented</span><span class="p">,</span><span class="bp">NotImplemented</span><span class="p">)</span></div>


<div class="viewcode-block" id="ContentionPipelineStep.checkInstall"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipelineStep.checkInstall">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">checkInstall</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compuFlags</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'networks.Network'</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">"""Checks if an instance of the contention step should be installed at this node. The subclass MUST OVERRIDE this method. </span>

<span class="sd">        Args:</span>
<span class="sd">            compuFlags (Mapping): the dictionnary of computationnal flags as extracted for this output port on this physical node of this network.</span>
<span class="sd">            net (Network): the reference to the Network object that nodeName belongs to</span>
<span class="sd">            nodeName (str): the name of the current node, on which we want to check if we need to install an instance of this pipeline element</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if an instance of the current class must be installed on the contention pipeline of the node 'nodeName', False otherwise</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="ContentionPipelineStep.getConfiguredInstanceForNode"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipelineStep.getConfiguredInstanceForNode">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getConfiguredInstanceForNode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compuFlags</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'networks.Network'</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'ContentionPipelineStep'</span><span class="p">:</span>
        <span class="sd">""" Retrieves a configured instance of the current class for the node nodeName</span>

<span class="sd">        Args:</span>
<span class="sd">            compuFlags (Mapping): the dictionnary of computationnal flags as extracted for this output port on this physical node of this network.</span>
<span class="sd">            net (Network): the reference to the Network object that nodeName belongs to</span>
<span class="sd">            nodeName (str): the name of the current node, on which we want to check if we need to install an instance of this pipeline element</span>

<span class="sd">        Returns:</span>
<span class="sd">            ContentionPipelineStep : a configured instance of the subclass, configured for the node 'nodeName'</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span></div></div>

<div class="viewcode-block" id="FifoContentionStep"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.FifoContentionStep">[docs]</a><span class="k">class</span> <span class="nc">FifoContentionStep</span><span class="p">(</span><span class="n">ContentionPipelineStep</span><span class="p">):</span>
    <span class="sd">"""This implementation of ContentionPipelineStep represents the classic FIFO service provided to the aggregate of flows, served by a service curve</span>
<span class="sd">    """</span>
    
    <span class="n">_plotDelayComputation</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">_plotKargs</span><span class="p">:</span> <span class="n">Mapping</span>
    <span class="n">_serviceCurve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span>


<div class="viewcode-block" id="FifoContentionStep.checkInstall"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.FifoContentionStep.checkInstall">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">checkInstall</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compuFlags</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'networks.Network'</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">""" In this implementation of the checkInstall interface method, we answer yes if the key "service-policy" of compuFlags is set to "FIRST_IN_FIRST_OUT"</span>

<span class="sd">        Args:</span>
<span class="sd">            compuFlags (Mapping): the dictionnary of computationnal flags as extracted for this output port on this physical node of this network.</span>
<span class="sd">            net (Network): the reference to the Network object that nodeName belongs to</span>
<span class="sd">            nodeName (str): the name of the current node, on which we want to check if we need to install an instance of this pipeline element</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the key "service-policy" of compuFlags is set to "FIRST_IN_FIRST_OUT". False otherwise</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">compuFlags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"service-policy"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"FIRST_IN_FIRST_OUT"</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s2">"FIFO"</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"\+|\:|\/"</span><span class="p">,</span> <span class="n">compuFlags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"technology"</span><span class="p">,</span><span class="s2">""</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">"transmission-capacity"</span> <span class="ow">in</span> <span class="n">compuFlags</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>
    
<div class="viewcode-block" id="FifoContentionStep.getConfiguredInstanceForNode"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.FifoContentionStep.getConfiguredInstanceForNode">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getConfiguredInstanceForNode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compuFlags</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'networks.Network'</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'ContentionPipelineStep'</span><span class="p">:</span>
        <span class="sd">""" Retrieves a configured instance of the current class for the node 'nodeName'</span>

<span class="sd">        Args:</span>
<span class="sd">            compuFlags (Mapping): the dictionnary of computationnal flags as extracted for this output port on this physical node of this network.</span>
<span class="sd">            net (Network): the reference to the Network object that nodeName belongs to</span>
<span class="sd">            nodeName (str): the name of the current node, on which we want to check if we need to install an instance of this pipeline element</span>

<span class="sd">        Returns:</span>
<span class="sd">            ContentionPipelineStep : a configured instance of the subclass, configured for the node 'nodeName'</span>
<span class="sd">        """</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">FifoContentionStep</span><span class="p">(</span><span class="n">nodeName</span><span class="p">)</span>
        <span class="c1">#Service is a rate-latency service curve. </span>
        <span class="c1"># 'tech-latency' is supposed to be the MAXIMAL tech latency, min is supposed to be 0</span>
        <span class="c1"># rate is the 'service-rate' if present, otherwise it is transmission-capacity</span>
    
        <span class="n">rate</span> <span class="o">=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readRate</span><span class="p">(</span><span class="n">compuFlags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"service-rate"</span><span class="p">,</span><span class="s2">"0"</span><span class="p">))</span>
        <span class="n">latency</span> <span class="o">=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readTime</span><span class="p">(</span><span class="n">compuFlags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"service-latency"</span><span class="p">,</span><span class="s2">"0"</span><span class="p">))</span>
        <span class="n">step</span><span class="o">.</span><span class="n">setServiceCurve</span><span class="p">(</span><span class="n">mpt</span><span class="o">.</span><span class="n">RateLatencyServiceCurve</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="n">latency</span><span class="p">))</span>
        <span class="c1"># a flag to plot the delay computation</span>
        <span class="k">if</span><span class="p">(</span><span class="n">compuFlags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"plot-delay-computation"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"True"</span><span class="p">):</span>
            <span class="n">step</span><span class="o">.</span><span class="n">_plotDelayComputation</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">step</span><span class="o">.</span><span class="n">_plotKargs</span> <span class="o">=</span> <span class="n">compuFlags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"plot-delay-computation-flags"</span><span class="p">,</span> <span class="nb">dict</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">step</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nodeName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotDelayComputation</span> <span class="o">=</span> <span class="kc">False</span>
    
<div class="viewcode-block" id="FifoContentionStep.setServiceCurve"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.FifoContentionStep.setServiceCurve">[docs]</a>    <span class="k">def</span> <span class="nf">setServiceCurve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Sets the service curve serving the aggregate</span>

<span class="sd">        Args:</span>
<span class="sd">            curve (mpt.Curve): the service curve for this FIFO element</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_serviceCurve</span> <span class="o">=</span> <span class="n">curve</span></div>
    
<div class="viewcode-block" id="FifoContentionStep.getServiceCurveCopy"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.FifoContentionStep.getServiceCurveCopy">[docs]</a>    <span class="k">def</span> <span class="nf">getServiceCurveCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_serviceCurve</span><span class="p">)</span></div>

<div class="viewcode-block" id="FifoContentionStep.executeStep"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.FifoContentionStep.executeStep">[docs]</a>    <span class="k">def</span> <span class="nf">executeStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowStates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">flows</span><span class="o">.</span><span class="n">FlowState</span><span class="p">],</span> <span class="n">aggregatedArrivalCurve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">,</span> <span class="n">previousMinDelay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">previousMaxDelay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">""" In this implementation of the interface method, the maximum delay bound is obtained by deconvolution of the aggregate arrival curve with the self._serviceCurve</span>

<span class="sd">        Args:</span>
<span class="sd">            flowStates (List[flows.FlowState]): not used in this subclass</span>
<span class="sd">            aggregatedArrivalCurve (mpt.Curve): used to compute the delay bound as being the maximum horizontal distance between aggregatedArrivalCurve and the service curve of self</span>
<span class="sd">            previousMinDelay (float): not used in this subclass</span>
<span class="sd">            previousMaxDelay (float): not used in this subclass</span>
<span class="sd">            flags (dict): this class ADDS the following keys to the FLAGS: </span>
<span class="sd">                - flags["service_is_rate_latency"] is set to True if the service of self is Rate-Latency, False otherwise</span>
<span class="sd">                - if flags["service_is_rate_latency"] == True:</span>
<span class="sd">                    - flags["rate_latency_service_rate"] contains the rate of the Rate-Latency service curve of self</span>
<span class="sd">                    - flags["rate_latency_service_latency"] contains the latency of the Rate-Latency service curve of self</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float,float]: (0,maxDelayBound) where maxDelayBound is the maximum horizontal distance between the aggregate arrival curve and the service curve computed using the mpt's modulo (%) operation. Minimum delay is always assumed to equal zero, use other pipeline steps or other pipelines to set the minimum delay</span>
<span class="sd">        """</span>
        <span class="c1"># set some flags to pass on information for next steps in the contention pipeline</span>
        <span class="n">flags</span><span class="p">[</span><span class="s2">"service_is_rate_latency"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_serviceCurve</span><span class="p">,</span> <span class="n">mpt</span><span class="o">.</span><span class="n">RateLatencyServiceCurve</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="n">flags</span><span class="p">[</span><span class="s2">"service_is_rate_latency"</span><span class="p">]):</span>
            <span class="n">flags</span><span class="p">[</span><span class="s2">"rate_latency_service_rate"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serviceCurve</span><span class="o">.</span><span class="n">get_rate</span><span class="p">()</span>
            <span class="n">flags</span><span class="p">[</span><span class="s2">"rate_latency_service_latency"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serviceCurve</span><span class="o">.</span><span class="n">get_latency</span><span class="p">()</span>
 
        <span class="c1"># compute delay bound (max horizontal distance between aggregated arrival curve and this service curve)</span>
        <span class="c1"># minimum delay is assumed to be 0</span>
        <span class="c1">#Always in TAI strat</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">Clock</span><span class="o">.</span><span class="n">worsen_service_curve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_serviceCurve</span><span class="p">)</span>
        <span class="n">Dmax</span> <span class="o">=</span> <span class="n">aggregatedArrivalCurve</span>  <span class="o">%</span> <span class="n">sc</span>
        <span class="k">if</span><span class="p">(</span><span class="n">flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"plot-delay-computation"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotDelayComputation</span><span class="p">):</span>
            <span class="c1">#set the name of the curves for the plot</span>
            <span class="n">aggregatedArrivalCurve</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">"AC"</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_serviceCurve</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s2">"SC"</span><span class="p">)</span>
            <span class="n">mpt</span><span class="o">.</span><span class="n">plot_a_delay_computation</span><span class="p">(</span><span class="n">aggregatedArrivalCurve</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_serviceCurve</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_plotKargs</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">:Fifo:Dmax=</span><span class="si">%.4e</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">,</span> <span class="n">Dmax</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Dmax</span><span class="p">)</span></div></div>
    
<div class="viewcode-block" id="MohammadpourEtAlImprovementStep"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.MohammadpourEtAlImprovementStep">[docs]</a><span class="k">class</span> <span class="nc">MohammadpourEtAlImprovementStep</span><span class="p">(</span><span class="n">ContentionPipelineStep</span><span class="p">):</span>
    <span class="sd">""" This implementation of ContentionPipelineStep represents the improvement proved by Mohammadpour et al when the output rate is known.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        abbrvInTechnoThatTriggersInstallation (str): a string that triggers the installation of MohammadpourEtAlImprovementStep instances on every node if present on the technology network-level flag</span>
<span class="sd">    """</span>


    <span class="n">_outputLinkSpeed</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">abbrvInTechnoThatTriggersInstallation</span> <span class="o">=</span> <span class="s2">"MOH"</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">,</span> <span class="n">outputLinkSpeed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nodeName</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputLinkSpeed</span> <span class="o">=</span> <span class="n">outputLinkSpeed</span>

    
<div class="viewcode-block" id="MohammadpourEtAlImprovementStep.setOutputLinkSpeed"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.MohammadpourEtAlImprovementStep.setOutputLinkSpeed">[docs]</a>    <span class="k">def</span> <span class="nf">setOutputLinkSpeed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linkSpeed</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_outputLinkSpeed</span> <span class="o">=</span> <span class="n">linkSpeed</span></div>
    
<div class="viewcode-block" id="MohammadpourEtAlImprovementStep.checkInstall"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.MohammadpourEtAlImprovementStep.checkInstall">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">checkInstall</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compuFlags</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'networks.Network'</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">""" In this implementation of the interface method, we answer True if [the flag 'technology' contains 'MOH' AND compuFlags contain 'transmission-capacity'], False otherwize</span>

<span class="sd">        Args:</span>
<span class="sd">            compuFlags (Mapping): the dictionnary of computationnal flags as extracted for this output port on this physical node of this network.</span>
<span class="sd">            net (Network): the reference to the Network object that nodeName belongs to</span>
<span class="sd">            nodeName (str): the name of the current node, on which we want to check if we need to install an instance of this pipeline element</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if [the flag 'technology' contains 'MOH' AND compuFlags contain 'transmission-capacity'], False otherwize</span>
<span class="sd">        """</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">abbrvInTechnoThatTriggersInstallation</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"\+|\:|\/"</span><span class="p">,</span> <span class="n">compuFlags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"technology"</span><span class="p">,</span><span class="s2">""</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">"transmission-capacity"</span> <span class="ow">in</span> <span class="n">compuFlags</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>
    
<div class="viewcode-block" id="MohammadpourEtAlImprovementStep.getConfiguredInstanceForNode"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.MohammadpourEtAlImprovementStep.getConfiguredInstanceForNode">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getConfiguredInstanceForNode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compuFlags</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'networks.Network'</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'ContentionPipelineStep'</span><span class="p">:</span>
        <span class="sd">""" Retrieves a configured instance of the current class for the node nodeName</span>

<span class="sd">        Args:</span>
<span class="sd">            compuFlags (Mapping): the dictionnary of computationnal flags as extracted for this output port on this physical node of this network.</span>
<span class="sd">            net (Network): the reference to the Network object that nodeName belongs to</span>
<span class="sd">            nodeName (str): the name of the current node, on which we want to check if we need to install an instance of this pipeline element</span>

<span class="sd">        Returns:</span>
<span class="sd">            ContentionPipelineStep : a configured instance of the subclass, configured for the node nodeName</span>
<span class="sd">        """</span>
        <span class="c1">#obtain the outSpeed</span>
        <span class="n">outSpeed</span> <span class="o">=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readRate</span><span class="p">(</span><span class="n">compuFlags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"transmission-capacity"</span><span class="p">,</span><span class="s2">"1"</span><span class="p">))</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">MohammadpourEtAlImprovementStep</span><span class="p">(</span><span class="n">nodeName</span><span class="p">,</span> <span class="n">outSpeed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">step</span></div>
        
    <span class="k">def</span> <span class="nf">_getMinimumPacketLength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listOfFlowStates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">flows</span><span class="o">.</span><span class="n">FlowState</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">""" Returns the minimum packet length on a set of flow states</span>

<span class="sd">        Args:</span>
<span class="sd">            listOfFlowStates (List[flows.FlowState]): a list of flow states</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: the minimum packet length across all the flowstates</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">minPacketLength</span> <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">listOfFlowStates</span><span class="p">)</span>
    

<div class="viewcode-block" id="MohammadpourEtAlImprovementStep.executeStep"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.MohammadpourEtAlImprovementStep.executeStep">[docs]</a>    <span class="k">def</span> <span class="nf">executeStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowStates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">flows</span><span class="o">.</span><span class="n">FlowState</span><span class="p">],</span> <span class="n">aggregatedArrivalCurve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">,</span> <span class="n">previousMinDelay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">previousMaxDelay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">""" In this implementation of the interface method, we return a negative maximum delay to represent the improvement proved by Mohammadpour et al.</span>

<span class="sd">        Args:</span>
<span class="sd">            flowStates (List[flows.FlowState]): the list of flow states at the input of the contention pipeline. Used to obtain min packet size</span>
<span class="sd">            aggregatedArrivalCurve (mpt.Curve): not used in this subclass</span>
<span class="sd">            previousMinDelay (float): not used in this subclass</span>
<span class="sd">            previousMaxDelay (float): not used in this subclass</span>
<span class="sd">            flags (dict): this step READS the following flags:</span>
<span class="sd">                - if flags["service_is_rate_latency"] == False, no improvement is done. Otherwise, it REQUIRES the following flag:</span>
<span class="sd">                    - flags["rate_latency_service_rate"] is the rate of the rate-latency service rate, required for the computation of the delay bound improvement </span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float,float]: (0,improvement) where improvement is a negative value that represents the improvement of the delay thanks to the Mohammadpour et al theorem</span>
<span class="sd">        """</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="n">flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"service_is_rate_latency"</span><span class="p">,</span><span class="kc">False</span><span class="p">)):</span>
            <span class="c1">#service is not rate-latency, no improvement, exit</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="n">flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"rate_latency_service_rate"</span><span class="p">)</span>
        <span class="n">lmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getMinimumPacketLength</span><span class="p">(</span><span class="n">flowStates</span><span class="p">)</span>
        <span class="c1"># see http://doi.org/10.1109/LNET.2019.2927143</span>
        <span class="n">improv</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lmin</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">rate</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_outputLinkSpeed</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1">#improvement: return negative delay for this contention step</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"</span><span class="si">%s</span><span class="s2">:Moh:Improv=</span><span class="si">%.4e</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span><span class="p">,</span> <span class="n">improv</span><span class="p">))</span>
        <span class="c1"># no min delay</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="p">(</span><span class="n">improv</span><span class="p">))</span></div></div>
<div class="viewcode-block" id="ContentionPipeline"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipeline">[docs]</a><span class="k">class</span> <span class="nc">ContentionPipeline</span><span class="p">:</span>
    <span class="sd">""" This class represents a contention pipeline. A contention pipeline is an ordered list of ContentionPipelineStep instances. Each step is executed one after the other one. Each step computes an additionnal lower and upper bounding value for the delay that the flows suffer in the contention part of the output port (for example constant delay, or jitter in the switch fabric could rather be added to the InputPipeline, though it is not required, it depends on what you want to do). All the lower and upper bounding values from every step are CUMMULATIVE: they are summed to obtain the definitive lower and upper bounding values of the delay that every flow suffers through this output port. Each step makes its decision based on the state of the flows and the aggregate arrival curve AT THE INPUT OF THE CONTENTION PIPELINE (these object are not updated through the contention pipeline AND MUST NOT BE MODIFIED BY ANY of the steps)</span>

<span class="sd">    Attributes:</span>
<span class="sd">        availableModules: only used at class level. List of available ContentionPipelineStep subclasses. Used for auto install. During auto install, each subclass, IN THE ORDER AT WHICH THEY APPEAR IN THIS LIST, is asked (using a classmethod) if an instance of the subclass should be installed in this contention pipeline, and if so, and instance is created and put in the contention pipeline</span>
<span class="sd">    """</span>
    <span class="c1"># The available subclasses of ContentionPipelineStep</span>
    <span class="n">availableModules</span> <span class="o">=</span> <span class="p">[</span><span class="n">FifoContentionStep</span><span class="p">,</span> <span class="n">MohammadpourEtAlImprovementStep</span><span class="p">]</span>

    <span class="c1"># The instances in this pipeline</span>
    <span class="n">_pipelineSteps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ContentionPipelineStep</span><span class="p">]</span>

    <span class="c1"># The flow states and input arrival curve </span>
    <span class="n">_inputAggregateAC</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span>
    <span class="n">_flowStates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">flows</span><span class="o">.</span><span class="n">FlowState</span><span class="p">]</span>

    <span class="c1"># Current delay min/max in the pipeline. Values are updated as every step of the pipeline is executed.</span>
    <span class="n">_delayMinInContentionPipeline</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">_delayMaxInContentionPipeline</span><span class="p">:</span> <span class="nb">float</span>

    <span class="c1"># Flags for this pipeline. DOES NOT MEAN the flags that are shared accross the pipeline steps</span>
    <span class="n">_flags</span><span class="p">:</span> <span class="nb">dict</span>

<div class="viewcode-block" id="ContentionPipeline.autoInstall"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipeline.autoInstall">[docs]</a>    <span class="k">def</span> <span class="nf">autoInstall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">compuFlags</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">net</span><span class="p">:</span> <span class="s1">'networks.Network'</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">""" Auto install a contention pipeline. To do so, every sclass in self.availableModules is asked whether an instance of the class should be installed for the contention pipeline of this node, and if so, an instance is added.</span>
<span class="sd">        Subclasses are sollicitated in the order of the list self.availableModules, so its order matters.</span>

<span class="sd">        Args:</span>
<span class="sd">            compuFlags (Mapping): the dictionnary of computational flags</span>
<span class="sd">            net (Network): the network</span>
<span class="sd">            nodeName (str): the name of the node on which we want to install a pipeline</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">avType</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">availableModules</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">avType</span><span class="o">.</span><span class="n">checkInstall</span><span class="p">(</span><span class="n">compuFlags</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">appendContentionStep</span><span class="p">(</span><span class="n">avType</span><span class="o">.</span><span class="n">getConfiguredInstanceForNode</span><span class="p">(</span><span class="n">compuFlags</span><span class="p">,</span> <span class="n">net</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="s2">"node_name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodeName</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipelineSteps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="c1"># set the flags of the pipeline: the pipeline is not finished</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="s2">"pipeline_finished"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flowStates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nodeName</span> <span class="o">=</span> <span class="n">nodeName</span>

<div class="viewcode-block" id="ContentionPipeline.appendContentionStep"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipeline.appendContentionStep">[docs]</a>    <span class="k">def</span> <span class="nf">appendContentionStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">ContentionPipelineStep</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Appends a ContentionPipelineStep to the current ContentionPipeline</span>

<span class="sd">        Args:</span>
<span class="sd">            step (ContentionPipelineStep): the step to add (added at the end of the pipeline)</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipelineSteps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">step</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="ContentionPipeline.setInputAggregate"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipeline.setInputAggregate">[docs]</a>    <span class="k">def</span> <span class="nf">setInputAggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregateAC</span> <span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Set the aggregate arrival curve that enters the contention pipeline (that enters the output port of the current node)</span>

<span class="sd">        Args:</span>
<span class="sd">            aggregateAC (mpt.Curve): the arrival curve of the aggregate</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputAggregateAC</span> <span class="o">=</span> <span class="n">aggregateAC</span></div>
    
<div class="viewcode-block" id="ContentionPipeline.setInputFlowStates"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipeline.setInputFlowStates">[docs]</a>    <span class="k">def</span> <span class="nf">setInputFlowStates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flowStates</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">flows</span><span class="o">.</span><span class="n">FlowState</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Sets (by copying) the flow states at the input of the contention pipeline</span>

<span class="sd">        Args:</span>
<span class="sd">            flowStates (List[flows.FlowState]): the list of the flow states as they enter the contention pipeline</span>
<span class="sd">        """</span>
        <span class="c1">#empty the list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flowStates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="c1">#do a copy of every flow state </span>
        <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="n">flowStates</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_flowStates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>
            <span class="c1">#not that the above copy does not copy the reference to the flow that is included in the flow state. In general, flow states may be copied but flows are never copied and this is the expected behaviour.</span>

<div class="viewcode-block" id="ContentionPipeline.processPipeline"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipeline.processPipeline">[docs]</a>    <span class="k">def</span> <span class="nf">processPipeline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Processes the current contention pipeline</span>

<span class="sd">        Raises:</span>
<span class="sd">            AssertionError: when the pipeline has already been processed</span>
<span class="sd">        """</span>
        <span class="c1">#this dict will be shared accross the different steps of the pipeline</span>
        <span class="n">flagsSharedBetweenPipelineSteps</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># only execute pipeline if not already done (otherwise flow states are updated again as if they went through the pipeline twice)</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"pipeline_finished"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">"'pipeline_finished' must be 'False' to process the pipeline. Cannot do it twice"</span><span class="p">)</span>
        <span class="c1"># prepare the delays</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delayMaxInContentionPipeline</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delayMinInContentionPipeline</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipelineSteps</span><span class="p">:</span>
            <span class="c1">#execute every step in the order of the pipeline</span>
            <span class="n">thisDelayMin</span><span class="p">,</span> <span class="n">thisDelayMax</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">executeStep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flowStates</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inputAggregateAC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delayMinInContentionPipeline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delayMaxInContentionPipeline</span><span class="p">,</span> <span class="n">flagsSharedBetweenPipelineSteps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delayMinInContentionPipeline</span> <span class="o">+=</span> <span class="n">thisDelayMin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delayMaxInContentionPipeline</span> <span class="o">+=</span> <span class="n">thisDelayMax</span>
        <span class="c1">#pipeline has finished</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="s2">"pipeline_finished"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span></div>
        

<div class="viewcode-block" id="ContentionPipeline.getContentionDelayBounds"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipeline.getContentionDelayBounds">[docs]</a>    <span class="k">def</span> <span class="nf">getContentionDelayBounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">"""Returns the lower and upper bounding values for the delays of the flows in the output port represented by the current contention pipeline</span>

<span class="sd">        Raises:</span>
<span class="sd">            AssertionError: if processPipeline() has not been called beforehand</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[float,float]: (minDelayBound,maxDelayBound) for this output port</span>
<span class="sd">        """</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"pipeline_finished"</span><span class="p">,</span><span class="kc">False</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s2">"Pipeline must be computed before calling getContentionDelayBounds()"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delayMinInContentionPipeline</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delayMaxInContentionPipeline</span></div>



<div class="viewcode-block" id="ContentionPipeline.isFinished"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipeline.isFinished">[docs]</a>    <span class="k">def</span> <span class="nf">isFinished</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">""" Answers True if the pipeline has been computed, False otherwise</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True is the pipeline has been processed, False otherwise</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"pipeline_finished"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="ContentionPipeline.clearPipelineComputations"><a class="viewcode-back" href="../../xtfa.contentionPipelines.html#xtfa.contentionPipelines.ContentionPipeline.clearPipelineComputations">[docs]</a>    <span class="k">def</span> <span class="nf">clearPipelineComputations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="s2">"pipeline_finished"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inputAggregateAC</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flowStates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delayMinInContentionPipeline</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delayMaxInContentionPipeline</span> <span class="o">=</span> <span class="kc">None</span></div></div>
    
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">networks</span>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Ludovic Thomas
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>