<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <meta name="generator" content="sphinx-4.5.0, furo 2022.04.07"/>
        <title>xtfa.flows - xTFA 2022-07 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=68f4518137b9aefe99b631505a2064c3c42c9852" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">xTFA 2022-07 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">xTFA 2022-07 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../relationmanuscript.html">Relations Between the Notions of the Manuscript and their Implementation in the Tool</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../modules.html">xtfa</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../xtfa.html">xtfa package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.GurobiInterface.html">xtfa.GurobiInterface module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.MilpInterface.html">xtfa.MilpInterface module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.baharevMfas.html">xtfa.baharevMfas module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.clocks.html">xtfa.clocks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.contentionPipelines.html">xtfa.contentionPipelines module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.fasUtility.html">xtfa.fasUtility module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.flows.html">xtfa.flows module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.graphUtility.html">xtfa.graphUtility module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.inputPipelines.html">xtfa.inputPipelines module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.lcan.html">xtfa.lcan module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.minPlusToolbox.html">xtfa.minPlusToolbox module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.networks.html">xtfa.networks module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.nodes.html">xtfa.nodes module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.outputPipelines.html">xtfa.outputPipelines module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.plotUtility.html">xtfa.plotUtility module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../xtfa.unitUtility.html">xtfa.unitUtility module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for xtfa.flows</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3</span>
<span class="c1">#</span>
<span class="c1"># This file is part of xTFA</span>
<span class="c1"># Copyright (c) 2021-2022 Ludovic Thomas (ISAE-SUPAERO)</span>
<span class="c1"># </span>
<span class="c1"># This program is free software: you can redistribute it and/or modify  </span>
<span class="c1"># it under the terms of the GNU General Public License as published by  </span>
<span class="c1"># the Free Software Foundation, version 3.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful, but </span>
<span class="c1"># WITHOUT ANY WARRANTY; without even the implied warranty of </span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU </span>
<span class="c1"># General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License </span>
<span class="c1"># along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">"""</span>
<span class="sd">This module containts the definition of flows and the definition of flow states</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">networkx</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Mapping</span>

<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">minPlusToolbox</span> <span class="k">as</span> <span class="n">mpt</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">unitUtility</span>
<span class="kn">from</span> <span class="nn">xtfa</span> <span class="kn">import</span> <span class="n">clocks</span>

<div class="viewcode-block" id="AtsCurveNotKnown"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.AtsCurveNotKnown">[docs]</a><span class="k">class</span> <span class="nc">AtsCurveNotKnown</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="CurveNotKnown"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.CurveNotKnown">[docs]</a><span class="k">class</span> <span class="nc">CurveNotKnown</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>


<div class="viewcode-block" id="Flow"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.Flow">[docs]</a><span class="k">class</span> <span class="nc">Flow</span><span class="p">:</span>
    <span class="sd">""" Represents a flow. = serie of data units originating from a single application in a single end-system.</span>
<span class="sd">    Each data unit follows a directed acyclic graph with a unique graph source (the source of the flow), the packets transporting the data unit may be duplicated/eliminated within the network.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            name:   the name of the flow</span>
<span class="sd">            source: the name of the source = of the output port at the source, not the name of the physical node. #TODO allow a flow to generate from several output ports</span>
<span class="sd">            sourceArrivalCurve: the arrival curve of the flow at the exit of the source application (before the output port of the source end-system)</span>
<span class="sd">            maxPacketLength:    the maximum length of any packet belonging to the flow</span>
<span class="sd">            minPacketLength:    the minimum length of any packet belonging to the flow</span>
<span class="sd">            graph:  the graph that any data unit follows in the network. </span>
<span class="sd">                    Vertexes = output port names. </span>
<span class="sd">                    Edges = from one output port name A to another output port name B if the data unit goes through A and then just after through B.</span>
<span class="sd">                    In the graph, a vertex that has two outgoing edges (A-&gt;B and A-&gt;C) represents the fact that multiplexing occurs and the packets are duplicated (the same data unit ends up being transported by several packets, one on the A-&gt;B path, the other on the A-&gt;C path). In the network switch fabric that contains output ports B and C, packets of the flow are duplicated and forwarded to both output ports B and C.</span>
<span class="sd">                    In the graph, elimination of packets (due to network failure OR due to duplicate elimination) ARE NOT REPRESENTED.</span>
<span class="sd">                        If X-&gt;Z, Y-&gt;Z and Z-&gt;A in the flow graph, then it DOES NOT NECESSARELY MEAN that the network switch containing output port Z eliminates the duplicate. The rate of the flow in output port Z and output port A MAY BE twice the flow rate.</span>
<span class="sd">                        In the present program paradigm, we do not model it by saying that we have two flows, we model it by saying that at Z or A, we may have two FlowState objects, representing the fact that we see packets that transport the data units OF THE SAME FLOW twice.</span>
<span class="sd">                        Wether the switch containing port Z, or the one containing port A, or the switch containing any following port performs duplicate elimination depends PIPELINE CONFIGURATION (input and output pipelines) of Z, A or any following port.</span>
<span class="sd">            trafficClass: the class of traffic that this flow belongs to</span>
<span class="sd">            properties: an additionnal dictionnary to store additionnal proporties of the flow, that are not required for the xTFA, such as deadline, etc.</span>
<span class="sd">    """</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">sources</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">sourceArrivalCurve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span>
    <span class="n">maxPacketLength</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">minPacketLength</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">graph</span><span class="p">:</span> <span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span>
    <span class="n">trafficClass</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">properties</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">networkx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<div class="viewcode-block" id="Flow.getFlowFromWopanetParams"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.Flow.getFlowFromWopanetParams">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getFlowFromWopanetParams</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'Flow'</span><span class="p">:</span>
        <span class="sd">""" Returns a Flow object, configured as per the keywords arguments provided, assuming the keywords are the same as in Wopanet. In particular, the arrival curve is described based on packet length, period and jitter</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">            - "name": the name of the flow (str)</span>
<span class="sd">            </span>
<span class="sd">            - "max-payload":    the maximum size of the packets for this flow (I will not add any overhead) (int)</span>
<span class="sd">            - "min-paylaod":    the minimum size of the packets for this flow (I will not add any overhead) (int)</span>
<span class="sd">            - "priority":   the traffic class (str)</span>
<span class="sd">            - "period": the period of the packets (float)(s)</span>
<span class="sd">            - "jitter": the jitter bound of the packets at the application's output (float)(s)</span>
<span class="sd">            - any other keyword is stored in the 'properties' dictionnary of the flow</span>

<span class="sd">        Returns:</span>
<span class="sd">            Flow: the configured instance</span>
<span class="sd">        """</span>
        <span class="n">localD</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="c1"># pop name and packet lengths to avoid duplicate information to be stored</span>
        <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"name"</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">maxPacketLength</span> <span class="o">=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readDataUnit</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"max-payload"</span><span class="p">,</span><span class="s2">"1500B"</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">minPacketLength</span> <span class="o">=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readDataUnit</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"min-payload"</span><span class="p">,</span><span class="s2">"0"</span><span class="p">))</span>
        <span class="c1">#add overhead</span>
        <span class="n">f</span><span class="o">.</span><span class="n">maxPacketLength</span> <span class="o">+=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readDataUnit</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"overhead"</span><span class="p">,</span><span class="s2">"16B"</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">minPacketLength</span> <span class="o">+=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readDataUnit</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"overhead"</span><span class="p">,</span><span class="s2">"16B"</span><span class="p">))</span>
        <span class="c1">#minimum 64 bytes</span>
        <span class="n">f</span><span class="o">.</span><span class="n">maxPacketLength</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">maxPacketLength</span><span class="p">,</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readDataUnit</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"minimum-packet-size"</span><span class="p">,</span><span class="s2">"64B"</span><span class="p">)))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">minPacketLength</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">minPacketLength</span><span class="p">,</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readDataUnit</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"minimum-packet-size"</span><span class="p">,</span><span class="s2">"64B"</span><span class="p">)))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">trafficClass</span> <span class="o">=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readPriority</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"priority"</span><span class="p">,</span><span class="s2">"0"</span><span class="p">))</span>
        <span class="k">if</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"arrival-curve"</span><span class="p">,</span><span class="s2">""</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"leaky-bucket"</span><span class="p">):</span>
            <span class="n">burst</span> <span class="o">=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readDataUnit</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"lb-burst"</span><span class="p">,</span><span class="s2">"0"</span><span class="p">))</span>
            <span class="n">rate</span> <span class="o">=</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readRate</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"lb-rate"</span><span class="p">,</span><span class="s2">"0"</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">sourceArrivalCurve</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">LeakyBucket</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="n">burst</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s2">"period"</span> <span class="ow">in</span> <span class="n">localD</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">setLeakyBucketInitialArrivalCurveWithPeriodAndJitter</span><span class="p">(</span><span class="n">unitUtility</span><span class="o">.</span><span class="n">readTime</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"period"</span><span class="p">)),</span> <span class="n">unitUtility</span><span class="o">.</span><span class="n">readTime</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"jitter"</span><span class="p">,</span><span class="s2">"0"</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">localD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">"max-simultaneous-packets"</span><span class="p">,</span><span class="s2">"1"</span><span class="p">)))</span>
            <span class="c1"># here in the future maybe look for other ways to configure the LB, such as having directly the burst/rate as keys in wopanet's xml</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">sourceArrivalCurve</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">NoCurve</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">localD</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="Flow.toWopanetAttributes"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.Flow.toWopanetAttributes">[docs]</a>    <span class="k">def</span> <span class="nf">toWopanetAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">:</span>
        <span class="sd">""" Write the flow as a dictionnary that can be given to the wopanet writter """</span>
        <span class="n">theDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">theDict</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">theDict</span><span class="p">[</span><span class="s2">"max-payload"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxPacketLength</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">theDict</span><span class="p">[</span><span class="s2">"min-payload"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minPacketLength</span> <span class="o">//</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">theDict</span><span class="p">[</span><span class="s2">"priority"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trafficClass</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceArrivalCurve</span><span class="p">,</span><span class="n">mpt</span><span class="o">.</span><span class="n">LeakyBucket</span><span class="p">)):</span>
            <span class="n">theDict</span><span class="p">[</span><span class="s2">"arrival-curve"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"leaky-bucket"</span>
            <span class="n">theDict</span><span class="p">[</span><span class="s2">"lb-burst"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceArrivalCurve</span><span class="o">.</span><span class="n">get_burst</span><span class="p">())</span>
            <span class="n">theDict</span><span class="p">[</span><span class="s2">"lb-rate"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sourceArrivalCurve</span><span class="o">.</span><span class="n">get_rate</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">:</span>
            <span class="n">theDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">theDict</span>    </div>

    

<div class="viewcode-block" id="Flow.getArrivalCurveAfterOutputPort"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.Flow.getArrivalCurveAfterOutputPort">[docs]</a>    <span class="k">def</span> <span class="nf">getArrivalCurveAfterOutputPort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputPort</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">:</span>
        <span class="sd">""" Returns the arrival curve for this flow at the OUTPUT of the output port 'outputPort'. If several flow states are present, their respective arrival curves are summed to obtain the arrival curve for this flow after the output port</span>

<span class="sd">        Args:</span>
<span class="sd">            outputPort (str): the output port for which we want the arrival curve of the flow AFTER</span>

<span class="sd">        Raises:</span>
<span class="sd">            AssertionError: in case xTFA has not computed output port 'outputPort' and hence such arrival curve is not known yet</span>

<span class="sd">        Returns:</span>
<span class="sd">            mpt.Curve: the arrival curve</span>
<span class="sd">        """</span>

        <span class="k">if</span><span class="p">(</span><span class="n">outputPort</span> <span class="o">==</span> <span class="s2">"source"</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sourceArrivalCurve</span>
        
        <span class="k">if</span><span class="p">(</span><span class="n">outputPort</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"ats:"</span><span class="p">)):</span>
            <span class="n">port</span> <span class="o">=</span> <span class="n">outputPort</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"ats:"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">"ats-curve"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">raise</span> <span class="n">AtsCurveNotKnown</span><span class="p">(</span><span class="s2">"ATS shaped curve not knwon yet at port </span><span class="si">%s</span><span class="s2"> for flows </span><span class="si">%s</span><span class="s2">. Either ATS does not exists in this port OR it has not been computed yet (case of fix-point computation)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">port</span><span class="p">][</span><span class="s2">"ats-curve"</span><span class="p">]</span>
            
        <span class="n">outgoingEdges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">out_edges</span><span class="p">(</span><span class="n">outputPort</span><span class="p">)</span>
        <span class="c1"># Arrival curves on all the edges are the same cause they all represent the same output port, the same physical link, so take first</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">outgoingEdges</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">"flow_states"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">raise</span> <span class="n">CurveNotKnown</span><span class="p">(</span><span class="s2">"Arrival curve for </span><span class="si">%s</span><span class="s2"> is not known yet at port </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">outputPort</span><span class="p">))</span>
        <span class="c1">#Sum all the flow states if we have several</span>
        <span class="n">curve</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">NoCurve</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">"flow_states"</span><span class="p">]:</span>
            <span class="n">curve</span> <span class="o">=</span> <span class="n">curve</span> <span class="o">+</span> <span class="n">fs</span><span class="o">.</span><span class="n">arrivalCurve</span>
        <span class="k">return</span> <span class="n">curve</span></div>

<div class="viewcode-block" id="Flow.registerSpecialInternalCurve"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.Flow.registerSpecialInternalCurve">[docs]</a>    <span class="k">def</span> <span class="nf">registerSpecialInternalCurve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">curve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span></div>

<div class="viewcode-block" id="Flow.setLeakyBucketInitialArrivalCurveWithPeriodAndJitter"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.Flow.setLeakyBucketInitialArrivalCurveWithPeriodAndJitter">[docs]</a>    <span class="k">def</span> <span class="nf">setLeakyBucketInitialArrivalCurveWithPeriodAndJitter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sourceJitter</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">maxSimultaneousPackets</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Sets the source arrival curve of self using a period-and-jitter description: the packets are supposed to be periodic at the output of the application but they may have a bounded jitter wrt a perfect periodic flow.</span>

<span class="sd">        Args:</span>
<span class="sd">            period (float): the ideal period of the packets in the flow</span>
<span class="sd">            sourceJitter (float): a bound on the jitter that the packets for this flow have at the output of the sending application</span>
<span class="sd">            maxSimultaneousPackets (int): a bound on the number of packets that can simultanously together, every period</span>
<span class="sd">        """</span>

        <span class="n">sourceJitterService</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">BoundedDelayServiceCurve</span><span class="p">(</span><span class="n">sourceJitter</span><span class="p">)</span>
        <span class="c1">#This is the ideal arrival curve the flow would have if perfectly periodic</span>
        <span class="n">sourceArrivalCurve</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">LeakyBucket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxPacketLength</span><span class="o">*</span><span class="n">maxSimultaneousPackets</span><span class="o">/</span><span class="n">period</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxPacketLength</span><span class="p">)</span>
        <span class="c1">#The deconvolution with the deltaD arrival curve representing the jitter gives the result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sourceArrivalCurve</span> <span class="o">=</span> <span class="n">sourceArrivalCurve</span> <span class="o">/</span> <span class="n">sourceJitterService</span></div>
    
<div class="viewcode-block" id="Flow.getListLeafVertices"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.Flow.getListLeafVertices">[docs]</a>    <span class="k">def</span> <span class="nf">getListLeafVertices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">out_degree</span><span class="p">[</span><span class="n">n</span><span class="p">])):</span>
                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span></div></div>

<div class="viewcode-block" id="FlowState"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState">[docs]</a><span class="k">class</span> <span class="nc">FlowState</span><span class="p">:</span>
    <span class="sd">""" Represents the (stationarry) state of a Flow at a specific point in the network</span>

<span class="sd">        Attributes:</span>
<span class="sd">            flow:   The flow for which the current object represents the state</span>
<span class="sd">            atEdge: The name of the graph edge that is the location of the considered FlowState. If A-&gt;B is the edge, then this FlowState represents the state of the flow JUST AFTER A. 'source' is reserved to represent the output of the sending application (BEFORE the source end-system output port).</span>
<span class="sd">            arrivalCurve:   The arrival curve of the flow at the specific above point.</span>
<span class="sd">            flags:  A dictionnary that can be used to store flags for computationnal purposes.</span>
<span class="sd">            minDelayFrom:   A dictionnary containing the minimum delay between the entries and the current position of this flow state: </span>
<span class="sd">                If A is an entry of minDelayFrom, then minDelayFrom[A] holds the minimum delay suffered by the flow between the OUTPUT of A and self.atEdge.</span>
<span class="sd">                'source' is reserved: minDelayFrom['source'] is the minimum delay suffered between the output of the sending application (BEFORE the source end-system output port) and self.atEdge</span>
<span class="sd">            maxDelayFrom:   Same as minDelayFrom, but for maximum delay bounds</span>
<span class="sd">            rtoFrom:    Same as above, but for RTO bounds  </span>
<span class="sd">    """</span>
    <span class="n">flow</span><span class="p">:</span> <span class="n">Flow</span>
    <span class="n">atEdge</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">arrivalCurve</span><span class="p">:</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span>
    <span class="n">clock</span><span class="p">:</span> <span class="n">clocks</span><span class="o">.</span><span class="n">Clock</span>
    <span class="n">flags</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">minDelayFrom</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">maxDelayFrom</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">rtoFrom</span><span class="p">:</span> <span class="nb">dict</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flow</span><span class="p">:</span> <span class="n">Flow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Constructor</span>
<span class="sd">        Args:</span>
<span class="sd">            flow (Flow): the flow for which the current object represent a state (a situation of the flow) at some point in the network</span>
<span class="sd">        """</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow</span> <span class="o">=</span> <span class="n">flow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrivalCurve</span> <span class="o">=</span> <span class="n">mpt</span><span class="o">.</span><span class="n">NoCurve</span><span class="p">()</span>
        <span class="c1">#initialize the dictionnaries with at least the 'source' key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">clocks</span><span class="o">.</span><span class="n">Clock</span><span class="p">(</span><span class="s2">"H"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="p">[</span><span class="s2">"source"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s2">"source"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">[</span><span class="s2">"source"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atEdge</span> <span class="o">=</span> <span class="s2">""</span>

<div class="viewcode-block" id="FlowState.isEqualFlowByNameAllKeysMustMatch"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.isEqualFlowByNameAllKeysMustMatch">[docs]</a>    <span class="k">def</span> <span class="nf">isEqualFlowByNameAllKeysMustMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span> <span class="s1">'FlowState'</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">""" Checks equality of flow states. Answer True if all the following conditions are met:</span>
<span class="sd">                - the name of the flow associated with this flow state (self.flow.name) is the same as the name of the flow associated with the other flow state (o.flow.name). Warning: no other field of self.flow and o.flow is checked, the name of the flow is here supposed to uniquely identify the Flow object.</span>
<span class="sd">                - both flow states are at the same edge (that is self.atEdge == o.atEdge)</span>
<span class="sd">                - both flow states have the same arrival curve (tested using the mpt equality definition)</span>
<span class="sd">                - both flow states have EXACTLY the same minDelayFrom/maxDelayFrom/rtoFrom dictionnaries. In particular, it means that they must have the same keys.</span>

<span class="sd">        Args:</span>
<span class="sd">            o (FlowState): the other flow state to test equality with</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: if content of flow states is the same, False otherwise</span>
<span class="sd">        """</span>
        <span class="n">matchDmax</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"match_d_max"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atEdge</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="n">atEdge</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span><span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrivalCurve</span> <span class="o">==</span> <span class="n">o</span><span class="o">.</span><span class="n">arrivalCurve</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span><span class="p">(</span><span class="n">matchDmax</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">'source'</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">o</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s1">'source'</span><span class="p">]):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FlowState.addDelayFromEntry"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.addDelayFromEntry">[docs]</a>    <span class="k">def</span> <span class="nf">addDelayFromEntry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fromEntryName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Add a 'From' entry into the dictionnary of delay bounds. Min and Max delays at this 'from' entry are initialized at 0.0</span>

<span class="sd">        Args:</span>
<span class="sd">            fromEntryName (str): the name of the node that is a reference. The origin of the delay is the OUTPUT of the node. 'source' is reserved to represent the output of the source application (ie before the output port of the source end-system).</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="p">[</span><span class="n">fromEntryName</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="n">fromEntryName</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="FlowState.addRtoFromEntry"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.addRtoFromEntry">[docs]</a>    <span class="k">def</span> <span class="nf">addRtoFromEntry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fromEntryName</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Add a 'From' entry into the dictionnary of the RTO bounds. The RTO is initialized at 0 for this entry.</span>

<span class="sd">        Args:</span>
<span class="sd">            fromEntryName (str): the name of the node that is a reference. The origin of the RTO is always the OUTPUT (or for a source, the internal application) of the node. 'source' is reserved to represent the output of the source application (ie before the output port of the source end-system).</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">[</span><span class="n">fromEntryName</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="FlowState.addDelaysToDisctionnaryWithoutChangingRto"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.addDelaysToDisctionnaryWithoutChangingRto">[docs]</a>    <span class="k">def</span> <span class="nf">addDelaysToDisctionnaryWithoutChangingRto</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxDelay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">minDelay</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">"""Add the min/max delay bound to all the entries in the min/max dictionnary. This DOES NOT change the arrival curve contained in the state. It DOES NOT change the RTO either.</span>

<span class="sd">        Args:</span>
<span class="sd">            maxDelay (float): maximum delay suffered to add</span>
<span class="sd">            minDelay (float, optional): minimum delay suffered to add. Defaults to 0.0.</span>
<span class="sd">        """</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">minDelay</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">maxDelay</span></div>

<div class="viewcode-block" id="FlowState.addSufferedDelay"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.addSufferedDelay">[docs]</a>    <span class="k">def</span> <span class="nf">addSufferedDelay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxDelay</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">minDelay</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">""" Change the current FlowState min/max/rto informations to include the fact that the flow suffered a variable delay. </span>
<span class="sd">        Set jitter_fifo = False in the kargs to notify that the suffered jitter is non FIFO (by default the jitter is assumed to be FIFO)</span>
<span class="sd">        This DOES NOT change the arrival curve of the flow state, don't forget to update the arrival curve as well.</span>

<span class="sd">        Args:</span>
<span class="sd">            maxDelay (float): the maximum delay suffered</span>
<span class="sd">            minDelay (float, optional): the minimum delay suffered. Defaults to 0.0.</span>
<span class="sd">        """</span>
        <span class="n">jitterFifo</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"jitter_fifo"</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addDelaysToDisctionnaryWithoutChangingRto</span><span class="p">(</span><span class="n">maxDelay</span><span class="p">,</span> <span class="n">minDelay</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">jitterFifo</span><span class="p">)):</span>
                <span class="c1">#EITHER RTO was already strictly positive, then any jitter (even FIFO) increases RTO</span>
                <span class="c1">#OR the jitter was non-FIFO, and then the RTO is increased for all entries in the dictionnary</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">maxDelay</span> <span class="o">-</span> <span class="n">minDelay</span><span class="p">)</span></div>

<div class="viewcode-block" id="FlowState.copy"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">'FlowState'</span><span class="p">:</span>
        <span class="sd">"""Returns a copy of self. Returns a FlowState with the same flow attribute (reference to the same object Flow), and the rest of the attributes are deepcopied.</span>

<span class="sd">        Returns:</span>
<span class="sd">            FlowState: a copy of self</span>
<span class="sd">        """</span>
        
        <span class="n">f</span> <span class="o">=</span> <span class="n">FlowState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">arrivalCurve</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrivalCurve</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">minDelayFrom</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">maxDelayFrom</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">rtoFrom</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">atEdge</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atEdge</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="FlowState.toStringWithoutAt"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.toStringWithoutAt">[docs]</a>    <span class="k">def</span> <span class="nf">toStringWithoutAt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">""" Generates a string to represent the FlowState self, without prompting the atEdge information</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: a string to represent the flow state</span>
<span class="sd">        """</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"digits"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2"> D_max=</span><span class="si">%.*e</span><span class="s2"> D_min=</span><span class="si">%.*e</span><span class="s2"> RTO=</span><span class="si">%.*e</span><span class="s2"> (s)(from source)"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrivalCurve</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">),</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="s2">"source"</span><span class="p">],</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="p">[</span><span class="s2">"source"</span><span class="p">],</span> <span class="n">d</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">[</span><span class="s2">"source"</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">s</span></div>

<div class="viewcode-block" id="FlowState.toString"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.toString">[docs]</a>    <span class="k">def</span> <span class="nf">toString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">"</span><span class="si">%s</span><span class="s2"> @ </span><span class="si">%s</span><span class="s2">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atEdge</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">toStringWithoutAt</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="FlowState.getCopyInternalArrivalCurve"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.getCopyInternalArrivalCurve">[docs]</a>    <span class="k">def</span> <span class="nf">getCopyInternalArrivalCurve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mpt</span><span class="o">.</span><span class="n">Curve</span><span class="p">:</span>
        <span class="sd">"""Returns a copy of the arrival curve, to which we add the burst penalty of the flag internal-burst-penalty if present</span>

<span class="sd">        Returns:</span>
<span class="sd">            mpt.Curve: the arrival Curve, perhaps worsens by a burst penalty if such a flag is present in the flow state flags</span>
<span class="sd">        """</span>
        <span class="n">retC</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrivalCurve</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="s2">"internal-penalty"</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">penaltyC</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s2">"internal-penalty"</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">retC</span> <span class="o">+</span> <span class="n">penaltyC</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">retC</span><span class="p">)</span></div>

<div class="viewcode-block" id="FlowState.changeClock"><a class="viewcode-back" href="../../xtfa.flows.html#xtfa.flows.FlowState.changeClock">[docs]</a>    <span class="k">def</span> <span class="nf">changeClock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newClock</span><span class="p">:</span> <span class="n">clocks</span><span class="o">.</span><span class="n">Clock</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">newClock</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">newClock</span><span class="p">)):</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrivalCurve</span> <span class="o">=</span> <span class="n">clocks</span><span class="o">.</span><span class="n">Clock</span><span class="o">.</span><span class="n">worsen_arrival_curve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrivalCurve</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">clocks</span><span class="o">.</span><span class="n">Clock</span><span class="o">.</span><span class="n">worsen_delay_lower_bound</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minDelayFrom</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">clocks</span><span class="o">.</span><span class="n">Clock</span><span class="o">.</span><span class="n">worsen_delay_upper_bound</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxDelayFrom</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="c1">#We only do this if the RTO is &gt; 0 because otherwise we're simply FIFO and we remain FIFO</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">clocks</span><span class="o">.</span><span class="n">Clock</span><span class="o">.</span><span class="n">worsen_delay_upper_bound</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rtoFrom</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div></div>
        


</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Ludovic Thomas
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>